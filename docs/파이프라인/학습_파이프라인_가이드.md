# ğŸ“ í•™ìŠµ íŒŒì´í”„ë¼ì¸ ì™„ì „ ê°€ì´ë“œ

## ğŸ—ï¸ í•™ìŠµ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "CLI ì§„ì…ì "
        A[train_main.py<br/>í†µí•© í•™ìŠµ ì¸í„°í˜ì´ìŠ¤<br/>CLI ì˜µì…˜ íŒŒì‹±]
    end
    
    subgraph "í•™ìŠµ ëª¨ë“œ ì„ íƒ"
        B[ğŸ“š basic ëª¨ë“œ<br/>ê¸°ë³¸ í•™ìŠµ ëª¨ë“œ<br/>train.py ì‚¬ìš©]
        C[âš¡ highperf ëª¨ë“œ<br/>ê³ ì„±ëŠ¥ í•™ìŠµ ëª¨ë“œ<br/>train_highperf.py ì‚¬ìš©]
        D[ğŸ”„ full-pipeline ëª¨ë“œ<br/>í•™ìŠµ + ì¶”ë¡  ì „ì²´ ì‹¤í–‰<br/>full_pipeline.py ì‚¬ìš©]
    end
    
    subgraph "ëª¨ë¸ ì•„í‚¤í…ì²˜"
        E[ğŸ“Š EfficientNet B3<br/>12M íŒŒë¼ë¯¸í„°<br/>224-320px]
        F[ğŸ† ConvNeXt Base 384<br/>89M íŒŒë¼ë¯¸í„°<br/>384px]
        G[ğŸ¯ Swin Transformer<br/>88M íŒŒë¼ë¯¸í„°<br/>384px]
    end
    
    subgraph "Team ê³ ì„±ëŠ¥ ê¸°ë²•"
        H[ğŸ’ª Hard Augmentation<br/>ë™ì  í™•ë¥  ìŠ¤ì¼€ì¤„ë§<br/>í™•ë¥  = 0.2 + 0.3 x ì§„í–‰ë¥ ]
        I[ğŸ¯ Essential TTA<br/>5ê°€ì§€ í•µì‹¬ ë³€í™˜<br/>0Â°, 90Â°, 180Â°, 270Â°, ë°ê¸°]
        J[ğŸŒ¡ï¸ Temperature Scaling<br/>ëª¨ë¸ ë³´ì •<br/>ì‹ ë¢°ë„ ì¡°ì •]
    end
    
    subgraph "ìµœì í™” ì‹œìŠ¤í…œ"
        K[ğŸ” Optuna íŠœë‹<br/>ë‹¤ì–‘í•œ í•˜ì´í¼íŒŒë¼ë¯¸í„°<br/>ë² ì´ì§€ì•ˆ ìµœì í™”]
        L[ğŸ¨ ì‹œê°í™” ì‹œìŠ¤í…œ<br/>ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§<br/>ê²°ê³¼ ì°¨íŠ¸ ìƒì„±]
    end
    
    A --> B
    A --> C Â 
    A --> D
    
    B --> E
    C --> F
    C --> G
    
    C --> H
    C --> I
    C --> J
    
    A --> K
    A --> L
    
    style A fill:#e1f5fe, color:#000000
    style C fill:#e8f5e8, color:#000000
    style F fill:#ffcdd2, color:#000000
    style H fill:#fff3e0, color:#000000
    style I fill:#f3e5f5, color:#000000
    style K fill:#ffebee, color:#000000
```

## ğŸ”€ íŒŒì´í”„ë¼ì¸ íë¦„ë„
```mermaid
flowchart LR
    A[ğŸ“ ë°ì´í„° ì¤€ë¹„<br/>data/raw/train/<br/>data/raw/meta.csv<br/>ì´ë¯¸ì§€ íŒŒì¼ ë° ë¼ë²¨ ë¡œë”©] --> B[ğŸ”€ Fold ë¶„í• <br/>KFold n=5<br/>stratified<br/>í´ë˜ìŠ¤ ê· í˜• ìœ ì§€]
    B --> C[ğŸ¯ ëª¨ë¸ í•™ìŠµ<br/>ê° Foldë³„<br/>GPU ê°€ì† í•™ìŠµ<br/>ë³‘ë ¬ ì²˜ë¦¬]
    C --> D[ğŸ“Š ê²€ì¦<br/>Validation<br/>F1-Score ê³„ì‚°<br/>ì„±ëŠ¥ í‰ê°€]
    D --> E[ğŸ’¾ ìµœì  ëª¨ë¸ ì €ì¥<br/>experiments/train/<br/>YYYYMMDD/model/results/ckpt/<br/>ë² ìŠ¤íŠ¸ ì²´í¬í¬ì¸íŠ¸ + ì‹œê°í™”]
    
    C --> F[Early Stopping<br/>+ LR Scheduler<br/>ê³¼ì í•© ë°©ì§€<br/>í•™ìŠµë¥  ì¡°ì •]
    F --> D
    D --> G[Best Model<br/>Selection<br/>ìµœê³  ì„±ëŠ¥ ëª¨ë¸<br/>ì„ íƒ ì €ì¥]
    G --> H[best_fold*.pth<br/>5ê°œ íŒŒì¼<br/>ê° Foldë³„<br/>ìµœì  ê°€ì¤‘ì¹˜]
    
    subgraph "ë°ì´í„° ì •ë³´"
        I[17ê°œ í´ë˜ìŠ¤<br/>2000+ ì´ë¯¸ì§€<br/>ë¶ˆê· í˜• ë°ì´í„°ì…‹]
        J[Train: 80%<br/>Valid: 20%<br/>ê³„ì¸µì  ë¶„í• ]
    end
    
    style A fill:#e1f5fe, color:#000000
    style E fill:#e8f5e8, color:#000000
    style H fill:#fff3e0, color:#000000
```

## ğŸ“ íŒŒì¼ ê°„ ì˜ì¡´ ê´€ê³„ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "âš™ï¸ ì„¤ì • íŒŒì¼"
        CONFIG1[configs/train.yaml<br/>ê¸°ë³¸ í•™ìŠµ ì„¤ì •]
        CONFIG2[configs/train_highperf.yaml<br/>ê³ ì„±ëŠ¥ í•™ìŠµ ì„¤ì •]
        CONFIG3[configs/train_fast_optimized.yaml<br/>ë¹ ë¥¸ í•™ìŠµ ì„¤ì •]
    end
    
    subgraph "ğŸ§  ì½”ì–´ í•™ìŠµ ì‹œìŠ¤í…œ"
        MAIN[src/training/train_main.py<br/>ë©”ì¸ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤<br/>ëª…ë ¹í–‰ íŒŒì‹±]
        TRAIN[src/training/train.py<br/>í•™ìŠµ ë¡œì§ êµ¬í˜„<br/>5-Fold CV ê´€ë¦¬]
        MODELS[src/models/build.py<br/>ëª¨ë¸ ì•„í‚¤í…ì²˜ ë¹Œë“œ<br/>ë°±ë³¸ ë„¤íŠ¸ì›Œí¬ ì„ íƒ]
        DATA[src/data/dataset.py<br/>ë°ì´í„° ë¡œë” êµ¬í˜„<br/>ì´ë¯¸ì§€ ì „ì²˜ë¦¬]
        UTILS[src/utils/core/common.py<br/>ê³µí†µ ìœ í‹¸ë¦¬í‹°<br/>ë¡œê¹… ë° í—¬í¼ í•¨ìˆ˜]
    end
    
    subgraph "ğŸ“Š ì…ë ¥ ë°ì´í„°"
        RAW[data/raw/train/<br/>ì›ë³¸ í•™ìŠµ ì´ë¯¸ì§€]
        META[data/raw/meta.csv<br/>ë¼ë²¨ ì •ë³´ ë° ë©”íƒ€ë°ì´í„°]
    end
    
    subgraph "ğŸ’¾ ì¶œë ¥ ê²°ê³¼"
        EXP[experiments/train/YYYYMMDD/<br/>ì‹¤í—˜ ê²°ê³¼ ì €ì¥ì†Œ<br/>images/ + results/ + logs/]
        LOGS[logs/YYYYMMDD/train/<br/>í•™ìŠµ ë¡œê·¸ ë° ë©”íŠ¸ë¦­]
        WANDB[wandb/run-*/<br/>ì‹¤í—˜ ì¶”ì  ë° ì‹œê°í™”]
    end
    
    CONFIG1 --> MAIN
    CONFIG2 --> MAIN
    CONFIG3 --> MAIN
    
    MAIN --> TRAIN
    MAIN --> MODELS
    MAIN --> DATA
    MAIN --> UTILS
    
    RAW --> DATA
    META --> DATA
    
    TRAIN --> EXP
    TRAIN --> LOGS
    TRAIN --> WANDB
    
    EXP --> FOLD1[best_fold0.pth<br/>ì²« ë²ˆì§¸ Fold ìµœì  ëª¨ë¸]
    EXP --> FOLD2[best_fold1.pth<br/>ë‘ ë²ˆì§¸ Fold ìµœì  ëª¨ë¸]
    EXP --> FOLD3[best_fold2.pth<br/>ì„¸ ë²ˆì§¸ Fold ìµœì  ëª¨ë¸]
    EXP --> FOLD4[best_fold3.pth<br/>ë„¤ ë²ˆì§¸ Fold ìµœì  ëª¨ë¸]
    EXP --> FOLD5[best_fold4.pth<br/>ë‹¤ì„¯ ë²ˆì§¸ Fold ìµœì  ëª¨ë¸]
    
    style CONFIG1 fill:#e1f5fe, color:#000000
    style CONFIG2 fill:#e8f5e8, color:#000000
    style CONFIG3 fill:#f3e5f5, color:#000000
    style MAIN fill:#fff3e0, color:#000000
    style EXP fill:#ffebee, color:#000000
```

### ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë° íŒŒì¼ ìƒì„¸ ì„¤ëª…

```text
ğŸ“ í•™ìŠµ íŒŒì´í”„ë¼ì¸ íŒŒì¼ êµ¬ì¡°
â”œâ”€â”€ src/training/
â”‚   â”œâ”€â”€ train_main.py                          # ğŸš€ ë©”ì¸ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ train.py                               # ğŸ§  í•µì‹¬ í•™ìŠµ ë¡œì§
â”‚   â”œâ”€â”€ train_highperf.py                      # ğŸ† ê³ ì„±ëŠ¥ í•™ìŠµ ë¡œì§
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/models/
â”‚   â”œâ”€â”€ build.py                               # ğŸ—ï¸ ëª¨ë¸ ì•„í‚¤í…ì²˜ ë¹Œë”
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/data/
â”‚   â”œâ”€â”€ dataset.py                             # ğŸ“Š ë°ì´í„°ì…‹ ë° ë¡œë”
â”‚   â”œâ”€â”€ transforms.py                          # ğŸ”„ ë°ì´í„° ì¦ê°•
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/metrics/
â”‚   â”œâ”€â”€ __init__.py
â”‚Â Â  â””â”€â”€ f1.cpython-311.py                     # 
â”‚
â”œâ”€â”€ src/utils/
â”‚   â”œâ”€â”€ core/                                  # ğŸ”§ í•µì‹¬ ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â””â”€â”€ common.py                          # ê³µí†µ í•¨ìˆ˜ (íŒŒì¼/YAML/ë¡œê¹…)
â”‚   â”œâ”€â”€ config/                                # âš™ï¸ ì„¤ì • ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ seed.py                            # ì‹œë“œ ì„¤ì •
â”‚   â”‚   â””â”€â”€ update_config_dates.py             # ì„¤ì • ë‚ ì§œ ì—…ë°ì´íŠ¸
â”‚   â”œâ”€â”€ gpu_optimization/                      # ï¿½ GPU ìµœì í™”
â”‚   â”‚   â”œâ”€â”€ auto_batch_size.py                 # ë™ì  ë°°ì¹˜ í¬ê¸° ê²°ì •
â”‚   â”‚   â””â”€â”€ team_gpu_check.py                  # GPU í™˜ê²½ ë¶„ì„
â”‚   â”œâ”€â”€ code_management/                       # ğŸ“‹ ì½”ë“œ ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ reorganize_experiments.py          # ì‹¤í—˜ ì •ë¦¬
â”‚   â”œâ”€â”€ visualizations/                        # ğŸ“Š ì‹œê°í™” ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ base_visualizer.py                 # ê¸°ë³¸ ì‹œê°í™” ì—”ì§„
â”‚   â”‚   â”œâ”€â”€ training_viz.py                    # í•™ìŠµ ì‹œê°í™”
â”‚   â”‚   â”œâ”€â”€ inference_viz.py                   # ì¶”ë¡  ì‹œê°í™”
â”‚   â”‚   â”œâ”€â”€ optimization_viz.py                # ìµœì í™” ì‹œê°í™”
â”‚   â”‚   â””â”€â”€ output_manager.py                  # ì¶œë ¥ ê´€ë¦¬
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/optimization/
â”‚   â”œâ”€â”€ optuna_optimize.py                     # ğŸ” í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/calibration/
â”‚   â”œâ”€â”€ calibrate.py                           # ğŸ“ ëª¨ë¸ ë³´ì •
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ src/logging/
â”‚   â”œâ”€â”€ logger.py                              # ï¿½ ë¡œê¹… ì‹œìŠ¤í…œ
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ train.yaml                             # âš™ï¸ ê¸°ë³¸ í•™ìŠµ ì„¤ì •
â”‚   â”œâ”€â”€ train_highperf.yaml                    # ğŸ† ê³ ì„±ëŠ¥ í•™ìŠµ ì„¤ì •
â”‚   â”œâ”€â”€ train_fast_optimized.yaml              # âš¡ ë¹ ë¥¸ í•™ìŠµ ì„¤ì •
â”‚   â”œâ”€â”€ optuna_config.yaml                     # ğŸ” í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
â”‚   â””â”€â”€ optuna_fast_config.yaml                # âš¡ ë¹ ë¥¸ íŠœë‹ ì„¤ì •
â”‚
â”œâ”€â”€ data/raw/
â”‚   â”œâ”€â”€ train/                                 # ğŸ“ í•™ìŠµ ì´ë¯¸ì§€ í´ë”
â”‚   â”œâ”€â”€ meta.csv                               # ğŸ“‹ ë¼ë²¨ ë° ë©”íƒ€ë°ì´í„°
â”‚   â””â”€â”€ sample_submission.csv                  # ğŸ“„ ì œì¶œ í˜•ì‹ ì˜ˆì‹œ
â”‚
â”œâ”€â”€ experiments/
â”‚   â”œâ”€â”€ train/YYYYMMDD/                        # ğŸ“ ë‚ ì§œë³„ í•™ìŠµ ì‹¤í—˜
â”‚   â”‚   â””â”€â”€ model_name_YYYYMMDD_HHMM/
â”‚   â”‚       â”œâ”€â”€ ckpt/                          # ğŸ’¾ ì²´í¬í¬ì¸íŠ¸ ì €ì¥ì†Œ
â”‚   â”‚       â”‚   â”œâ”€â”€ best_fold0.pth
â”‚   â”‚       â”‚   â”œâ”€â”€ best_fold1.pth
â”‚   â”‚       â”‚   â”œâ”€â”€ best_fold2.pth
â”‚   â”‚       â”‚   â”œâ”€â”€ best_fold3.pth
â”‚   â”‚       â”‚   â”œâ”€â”€ best_fold4.pth
â”‚   â”‚       â”‚   â””â”€â”€ last.pth                   # ë§ˆì§€ë§‰ ì—í¬í¬ ëª¨ë¸
â”‚   â”‚       â”œâ”€â”€ config.yaml                    # ì‹¤í—˜ ì„¤ì • ë°±ì—…
â”‚   â”‚       â””â”€â”€ metrics.json                   # ì„±ëŠ¥ ì§€í‘œ ê¸°ë¡
â”‚   â””â”€â”€ optimization/                          # ğŸ“ ìµœì í™” ì‹¤í—˜ ê²°ê³¼
â”‚
â”œâ”€â”€ logs/YYYYMMDD/
â”‚   â””â”€â”€ train/                                 # ğŸ“ í•™ìŠµ ë¡œê·¸
â”‚       â”œâ”€â”€ train_HHMM.log                     # í•™ìŠµ ì§„í–‰ ë¡œê·¸
â”‚       â””â”€â”€ metrics_HHMM.json                  # ì„±ëŠ¥ ì§€í‘œ ë¡œê·¸
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run_fast_training.sh                   # âš¡ ë¹ ë¥¸ í•™ìŠµ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ run_highperf_training.sh               # ğŸ† ê³ ì„±ëŠ¥ í•™ìŠµ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ monitor_training.sh                    # ğŸ“Š í•™ìŠµ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸
â”‚
â””â”€â”€ wandb/                                     # ğŸ“Š ì‹¤í—˜ ì¶”ì  ë°ì´í„°
    â””â”€â”€ run-*/                                 # WandB ì‹¤í–‰ ê¸°ë¡
```

#### ğŸ” í•µì‹¬ íŒŒì¼ ìƒì„¸ ê¸°ëŠ¥

**1. src/training/train_main.py**
- **ì£¼ìš” ê¸°ëŠ¥**: ëª…ë ¹í–‰ ì¸í„°í˜ì´ìŠ¤ ì œê³µ ë° í•™ìŠµ íŒŒì´í”„ë¼ì¸ í†µí•© ê´€ë¦¬
- **í•µì‹¬ ì—­í• **: 
  - argparseë¥¼ í†µí•œ ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
  - ì„¤ì • íŒŒì¼ ë¡œë”© ë° ê²€ì¦
  - í•™ìŠµ ëª¨ë“œ ì„ íƒ (ê¸°ë³¸/ê³ ì„±ëŠ¥/ë¹ ë¥¸ ëª¨ë“œ)
  - GPU ìë™ ê°ì§€ ë° ë¶„ì‚° í•™ìŠµ ì„¤ì •
- **ì˜ì¡´ì„±**: train.py, config íŒŒì¼ë“¤ê³¼ ì§ì ‘ ì—°ê²°

**2. src/training/train.py**
- **ì£¼ìš” ê¸°ëŠ¥**: 5-Fold Cross Validation ë° í•µì‹¬ í•™ìŠµ ë¡œì§ êµ¬í˜„
- **í•µì‹¬ ì—­í• **:
  - KFold ë°ì´í„° ë¶„í•  (Stratified ë°©ì‹)
  - ê° Foldë³„ ëª¨ë¸ í•™ìŠµ ê´€ë¦¬
  - Early Stopping ë° Learning Rate Scheduling
  - ê²€ì¦ ì„±ëŠ¥ í‰ê°€ (F1-Score, Accuracy)
  - ìµœì  ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥
- **ì˜ì¡´ì„±**: models/build.py, data/dataset.pyì™€ ê¸´ë°€í•œ ì—°ê²°

**3. src/models/build.py**
- **ì£¼ìš” ê¸°ëŠ¥**: ëª¨ë¸ ì•„í‚¤í…ì²˜ ë™ì  ë¹Œë”© ë° ë°±ë³¸ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬
- **í•µì‹¬ ì—­í• **:
  - EfficientNet, ResNet, Swin Transformer ë“± ë°±ë³¸ ì„ íƒ
  - ì‚¬ì „ í›ˆë ¨ ê°€ì¤‘ì¹˜ ë¡œë”©
  - ë¶„ë¥˜ í—¤ë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§• (17ê°œ í´ë˜ìŠ¤ ëŒ€ì‘)
  - ëª¨ë¸ íŒŒë¼ë¯¸í„° ì´ˆê¸°í™”
- **ì˜ì¡´ì„±**: timm, torchvision ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©

**4. src/data/dataset.py**
- **ì£¼ìš” ê¸°ëŠ¥**: ì»¤ìŠ¤í…€ ë°ì´í„°ì…‹ í´ë˜ìŠ¤ ë° ë°ì´í„° ë¡œë” êµ¬í˜„
- **í•µì‹¬ ì—­í• **:
  - ì´ë¯¸ì§€ íŒŒì¼ ë¡œë”© ë° ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
  - ë¼ë²¨ ì¸ì½”ë”© ë° í´ë˜ìŠ¤ ë§¤í•‘
  - ë°ì´í„° ì¦ê°• ì ìš© (Albumentations)
  - ë°°ì¹˜ ìƒì„± ë° GPU ë©”ëª¨ë¦¬ ìµœì í™”
- **ì˜ì¡´ì„±**: transforms.pyì™€ ì—°ë™í•˜ì—¬ ì¦ê°• ê¸°ë²• ì ìš©

**5. configs/train_*.yaml**
- **train.yaml**: ì¼ë°˜ì ì¸ ì‹¤í—˜ìš© ê¸°ë³¸ ì„¤ì • (EfficientNet-B3, 224px)
- **train_highperf.yaml**: ìµœê³  ì„±ëŠ¥ ì¶”êµ¬ ì„¤ì • (Swin-Base, 384px, ë‚®ì€ LR)
- **train_fast_optimized.yaml**: ë¹ ë¥¸ í”„ë¡œí† íƒ€ì… ì„¤ì • (ì‘ì€ ëª¨ë¸, ë†’ì€ LR)

## âš™ï¸ ì„¤ì • íŒŒì¼ ë° ì‹¤í–‰ ëª…ë ¹ì–´

### 1. ê¸°ë³¸ í•™ìŠµ ëª¨ë“œ (EfficientNet-B3)

#### ì„¤ì • íŒŒì¼: `configs/train.yaml`
```yaml
# í•µì‹¬ ì„¤ì •
model:
  name: efficientnet_b3
  img_size: 224
  num_classes: 17

train:
  epochs: 10
  batch_size: 32  # auto_batch_sizeë¡œ ìµœì í™” ê°€ëŠ¥
  learning_rate: 0.001
  
data:
  train_dir: data/raw/train
  csv_path: data/raw/train.csv
```

#### ê¸°ë³¸ ì‹¤í–‰ ëª…ë ¹ì–´
```bash
# ê°€ì¥ ê¸°ë³¸ì ì¸ í•™ìŠµ
python src/training/train_main.py --config configs/train.yaml

# ëª¨ë“œ ëª…ì‹œ (ê¸°ë³¸ê°’ì€ basic)
python src/training/train_main.py --config configs/train.yaml --mode basic
```

### 2. ê³ ì„±ëŠ¥ í•™ìŠµ ëª¨ë“œ (Swin Transformer)

#### ì„¤ì • íŒŒì¼: `configs/train_highperf.yaml`
```yaml
# ê³ ì„±ëŠ¥ ì„¤ì • (Team ê¸°ë²• ì ìš©)
model:
  name: "convnext_base_384_in22ft1k"  # Team ê³ ì„±ëŠ¥ ëª¨ë¸
  img_size: 384
  num_classes: 17
  drop_rate: 0.05                    # Team ì¶”ì²œ ì„¤ì •
  drop_path_rate: 0.1               # Stochastic Depth

train:
  epochs: 50                        # Team ì„±ëŠ¥ ë‹¬ì„±ìš©
  batch_size: 48                    # RTX 4090 ìµœì í™”
  lr: 0.0001                        # ëŒ€í˜• ëª¨ë¸ ì•ˆì •ì„±
  use_advanced_augmentation: true   # Team Hard Augmentation
  use_mixup: true                   # Mixup ë°ì´í„° ì¦ê°•
  mixup_alpha: 1.0                  # Team ì¶”ì²œìˆ˜ì¹˜
  label_smoothing: 0.05             # ê³¼ì í•© ë°©ì§€
```

#### ê³ ì„±ëŠ¥ ì‹¤í–‰ ëª…ë ¹ì–´
```bash
# ê³ ì„±ëŠ¥ ëª¨ë“œ
python src/training/train_main.py --config configs/train_highperf.yaml --mode highperf
```

## ğŸš€ ì‹¤í–‰ ì˜µì…˜ ì™„ì „ ê°€ì´ë“œ

### ê¸°ë³¸ ëª…ë ¹ì–´ êµ¬ì¡°
```bash
python src/training/train_main.py [í•„ìˆ˜ì˜µì…˜] [ì„ íƒì˜µì…˜]
```

### ğŸ“Š CLI ì˜µì…˜ ì™„ì „ ê°€ì´ë“œ

| ì˜µì…˜ | íƒ€ì… | í•„ìˆ˜/ì„ íƒ | ê¸°ë³¸ê°’ | choices | ì„¤ëª… |
|------|------|----------|--------|---------|------|
| `--config` | str | í•„ìˆ˜ | - | - | ì„¤ì • YAML íŒŒì¼ ê²½ë¡œ |
| `--mode` | str | ì„ íƒ | "full-pipeline" | ["basic", "highperf", "full-pipeline"] | ì‹¤í–‰ ëª¨ë“œ ì„ íƒ |
| `--skip-training` | flag | ì„ íƒ | False | - | í•™ìŠµ ê±´ë„ˆë›°ê³  ì¶”ë¡ ë§Œ ì‹¤í–‰ |
| `--optimize` | flag | ì„ íƒ | False | - | Optuna í•˜ì´í¼íŒŒë¼ë¯¸í„° ìµœì í™” |
| `--n-trials` | int | ì„ íƒ | 20 | - | Optuna ì‹œë„ íšŸìˆ˜ |
| `--optuna-config` | str | ì„ íƒ | None | - | Optuna ì„¤ì • íŒŒì¼ ê²½ë¡œ |
| `--use-calibration` | flag | ì„ íƒ | False | - | Temperature Scaling ì‚¬ìš© |
| `--auto-continue` | flag | ì„ íƒ | False | - | ìµœì í™” í›„ ìë™ ì§„í–‰ |

### ì„ íƒ ì˜µì…˜ ìƒì„¸ ì„¤ëª…

#### 1. `--mode <ëª¨ë“œ>`
**ê¸°ëŠ¥**: í•™ìŠµ íŒŒì´í”„ë¼ì¸ ëª¨ë“œ ì„ íƒ
**ì˜µì…˜ê°’**:
- `basic`: ê¸°ë³¸ í•™ìŠµ (ë¹ ë¦„, ì•ˆì •ì )
- `highperf`: ê³ ì„±ëŠ¥ í•™ìŠµ (ëŠë¦¼, ì •í™•í•¨)
- `full-pipeline`: í•™ìŠµ + ì¶”ë¡ ê¹Œì§€ ì „ì²´ ì‹¤í–‰

```bash
# ê¸°ë³¸ ëª¨ë“œ (30ë¶„)
python src/training/train_main.py --config configs/train.yaml --mode basic

# ê³ ì„±ëŠ¥ ëª¨ë“œ (1-2ì‹œê°„)
python src/training/train_main.py --config configs/train_highperf.yaml --mode highperf

# ì „ì²´ íŒŒì´í”„ë¼ì¸ (í•™ìŠµ+ì¶”ë¡ )
python src/training/train_main.py --config configs/train.yaml --mode full-pipeline
```

#### 2. `--optimize`
**ê¸°ëŠ¥**: Optuna í•˜ì´í¼íŒŒë¼ë¯¸í„° ìë™ ìµœì í™” í™œì„±í™”
**íš¨ê³¼**: learning_rate, batch_size, augmentation íŒŒë¼ë¯¸í„° ìë™ íŠœë‹

```bash
# ìµœì í™” ì—†ì´ í•™ìŠµ (ê¸°ë³¸ ì„¤ì • ì‚¬ìš©)
python src/training/train_main.py --config configs/train.yaml

# ìµœì í™”ì™€ í•¨ê»˜ í•™ìŠµ (ì„±ëŠ¥ í–¥ìƒ ê¸°ëŒ€)
python src/training/train_main.py --config configs/train.yaml --optimize
```

#### 3. `--n-trials <ìˆ«ì>`
**ê¸°ëŠ¥**: Optuna ìµœì í™” ì‹œë„ íšŸìˆ˜ ì„¤ì • (--optimizeì™€ í•¨ê»˜ ì‚¬ìš©)
**ê¸°ë³¸ê°’**: 20
**ê¶Œì¥ê°’**: 
- ë¹ ë¥¸ í…ŒìŠ¤íŠ¸: 5-10
- ì¼ë°˜ ìµœì í™”: 20
- ì™„ì „ ìµœì í™”: 50+

```bash
# ë¹ ë¥¸ ìµœì í™” (5ë²ˆ ì‹œë„)
python src/training/train_main.py --config configs/train.yaml --optimize --n-trials 5

# í‘œì¤€ ìµœì í™” (20ë²ˆ ì‹œë„)
python src/training/train_main.py --config configs/train.yaml --optimize --n-trials 20

# ì™„ì „ ìµœì í™” (50ë²ˆ ì‹œë„)
python src/training/train_main.py --config configs/train.yaml --optimize --n-trials 50
```

#### 4. `--use-calibration`
**ê¸°ëŠ¥**: Temperature Scaling ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í™œì„±í™”
**íš¨ê³¼**: ëª¨ë¸ ì‹ ë¢°ë„(confidence) í–¥ìƒ, ë” ì •í™•í•œ í™•ë¥  ì˜ˆì¸¡

```bash
# ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì—†ì´
python src/training/train_main.py --config configs/train.yaml

# ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í¬í•¨ (ì¶”ì²œ)
python src/training/train_main.py --config configs/train.yaml --use-calibration
```

#### 5. `--auto-continue`
**ê¸°ëŠ¥**: ìµœì í™” ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ì „ì²´ í•™ìŠµ ì§„í–‰ (--optimizeì™€ í•¨ê»˜ ì‚¬ìš©)

```bash
# ìµœì í™”ë§Œ ì‹¤í–‰ (ìˆ˜ë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰)
python src/training/train_main.py --config configs/train.yaml --optimize

# ìµœì í™” í›„ ìë™ìœ¼ë¡œ ì „ì²´ í•™ìŠµ ì§„í–‰
python src/training/train_main.py --config configs/train.yaml --optimize --auto-continue
```

#### 6. `--resume`
**ê¸°ëŠ¥**: ì¤‘ë‹¨ëœ í•™ìŠµì„ ì²´í¬í¬ì¸íŠ¸ë¶€í„° ì¬ê°œ

```bash
# ì²˜ìŒë¶€í„° í•™ìŠµ
python src/training/train_main.py --config configs/train.yaml

# ì¤‘ë‹¨ëœ ì§€ì ë¶€í„° ì¬ê°œ
python src/training/train_main.py --config configs/train.yaml --resume
```

## ğŸ¯ ì‹¤ì „ ì‚¬ìš© ì˜ˆì‹œ

### 1. ë¹ ë¥¸ ê²°ê³¼ í™•ì¸ (30ë¶„)
```bash
python src/training/train_main.py --config configs/train.yaml --mode basic
```

### 2. ìµœê³  ì„±ëŠ¥ ì¶”êµ¬ (2-3ì‹œê°„)
```bash
python src/training/train_main.py \
    --config configs/train_highperf.yaml \
    --mode highperf \
    --optimize \
    --n-trials 20 \
    --use-calibration \
    --auto-continue
```

### 3. ë¹ ë¥¸ ìµœì í™” í…ŒìŠ¤íŠ¸ (1ì‹œê°„)
```bash
python src/training/train_main.py \
    --config configs/train.yaml \
    --optimize \
    --n-trials 5 \
    --use-calibration
```

### 4. ì „ì²´ íŒŒì´í”„ë¼ì¸ (í•™ìŠµ+ì¶”ë¡ )
```bash
python src/training/train_main.py \
    --config configs/train_highperf.yaml \
    --mode full-pipeline \
    --use-calibration
```

### 5. ğŸš€ ë‹¨ì¼ í´ë“œ ìµœì í™” (ì‹ ê·œ - 2025.09.10 ì¶”ê°€)
**ë°°ê²½**: ê²½ì§„ëŒ€íšŒ ë§ˆê° ì‹œê°„ ë‹¨ì¶•ì„ ìœ„í•´ K-fold ëŒ€ì‹  ë‹¨ì¼ í´ë“œ + ì•™ìƒë¸” ì „ëµ ì ìš©

```bash
# ë‹¨ì¼ í´ë“œ í•˜ì´í¼íŒŒë¼ë¯¸í„° ìµœì í™” (ë§¤ìš° ë¹ ë¦„ - 2ë¶„/trial)
python src/training/train_main.py \
    --config configs/train_highperf.yaml \
    --mode full-pipeline \
    --use-calibration \
    --optimize \
    --optuna-config configs/optuna_single_fold_config.yaml \
    --auto-continue
```

**í•µì‹¬ ê°œì„ ì‚¬í•­:**
- âš¡ **ì†ë„ í–¥ìƒ**: ë§¤ trial 2ì´ˆ ì™„ë£Œ (ë°ì´í„°ì…‹ ìºì‹± ì ìš©)
- ğŸ¯ **ì‹¤ì œ F1 ì ìˆ˜**: ì‹œë®¬ë ˆì´ì…˜ ì•„ë‹Œ ì‹¤ì œ í•™ìŠµ ê¸°ë°˜ í‰ê°€
- ğŸ“Š **ë†’ì€ ì„±ëŠ¥**: F1 0.947+ ë‹¬ì„± ê°€ëŠ¥
- ğŸ”§ **ë©”ëª¨ë¦¬ ìµœì í™”**: ìºì‹œëœ ë°ì´í„°ë¡œ ë°˜ë³µ í•™ìŠµ ì†ë„ ê·¹ëŒ€í™”

**ì„¤ì • íŒŒì¼**: `configs/optuna_single_fold_config.yaml`
```yaml
optuna:
  n_trials: 20              # ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ìš© (ì‹¤ì œ 100+ ê¶Œì¥)
  n_jobs: 1                 # GPU ë©”ëª¨ë¦¬ì— ë”°ë¼ ì¡°ì •
  single_fold_validation:
    epochs: 5               # ë¹ ë¥¸ ê²€ì¦ìš©
    validation_split: 0.2   # 80:20 ë¶„í• 
```

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ ë° Team ê¸°ë²• ë¶„ì„

### ğŸ† ìµœì‹  vs ê¸°ì¡´ ì„±ëŠ¥ ë¹„êµ

| êµ¬ë¶„ | ëª¨ë¸ | F1 Score | ì„±ëŠ¥ í–¥ìƒ | ì‹¤í—˜ ì¼ì‹œ | í•µì‹¬ ê¸°ë²• |
|------|------|----------|----------|---------|---------|
| **ê¸°ì¡´ ë² ì´ìŠ¤ë¼ì¸** | EfficientNet B3 | 0.9238 | - | - | ê¸°ë³¸ ì¦ê°• |
| **ê³ ì„±ëŠ¥ ìµœì‹ ** | ConvNeXt Base 384 | **0.98362** | **+6.5%** | 2025-09-10 12:13 | **ìµœì í™”ëœ ì „ì²´ ê¸°ë²•** |
| **ê³ ì„±ëŠ¥ ì´ì „** | ConvNeXt Base 384 | **0.97918** | **+5.9%** | 2025-09-10 09:29 | Hard Aug + TTA + ìº˜ë¦¬ë¸Œë ˆì´ì…˜ |

### âš¡ ì‹¤í–‰ ëª¨ë“œë³„ ì„±ëŠ¥ ë¶„ì„

| ì‹¤í–‰ ì˜µì…˜ | ì˜ˆìƒ ì‹œê°„ | ì˜ˆìƒ F1 | GPU ë©”ëª¨ë¦¬ | Team ê¸°ë²• ì ìš© | ì¶”ì²œ ìƒí™© |
|-----------|-----------|---------|------------|-------------|-----------|
| `--mode basic` | 30ë¶„ | 0.920-0.930 | 8GB | âŒ | ë¹ ë¥¸ í”„ë¡œí† íƒ€ì… |
| `--mode basic --optimize` | 1ì‹œê°„ | 0.935-0.945 | 8GB | ë¶€ë¶„ì  | ê°œì„ ëœ ë² ì´ìŠ¤ë¼ì¸ |
| `--mode highperf` | 2ì‹œê°„ | **0.950-0.965** | 16GB | âœ… **ì „ì²´** | **ìµœì¢… ì œì¶œìš©** |
| `--mode highperf --optimize` | 3ì‹œê°„ | **0.965+** | 16GB | âœ… **ì „ì²´+íŠœë‹** | **ëŒ€íšŒ ìš°ìŠ¹ìš©** |
| **ğŸš€ ë‹¨ì¼ í´ë“œ ìµœì í™”** | **23ë¶„** | **0.969-0.984** | **12GB** | âœ… **ìºì‹±+ìµœì í™”** | **âš¡ ë¹ ë¥¸ ê²½ì§„ëŒ€íšŒìš©** |

### ğŸ¯ Team ê³ ì„±ëŠ¥ ê¸°ë²•ë³„ ê¸°ì—¬ë„

| ê¸°ë²• | ì„±ëŠ¥ ê¸°ì—¬ | êµ¬í˜„ ìœ„ì¹˜ | ì„¤ëª… |
|------|----------|---------|------|
| **ConvNeXt ImageNet-22k** | +2.0% | `configs/train_highperf.yaml` | ì‚¬ì „í•™ìŠµ ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ |
| **Hard Augmentation** | +1.5% | `src/data/transforms.py:180-216` | ë™ì  í™•ë¥  ìŠ¤ì¼€ì¤„ë§ |
| **Essential TTA** | +0.8% | `src/data/transforms.py:221-250` | 5ê°€ì§€ í•µì‹¬ ë³€í™˜ |
| **Temperature Scaling** | +0.3% | `src/calibration/` | í™•ë¥  ë³´ì • |
| **ì „ì²´ ì¡°í•©** | **+4.14%** | í†µí•© ì ìš© | ì‹œë„ˆì§€ íš¨ê³¼ |

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° íŒ

### GPU ë©”ëª¨ë¦¬ ìµœì í™”
```bash
# GPU ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ
python src/utils/gpu_optimization/auto_batch_size.py --config configs/train.yaml
python src/training/train_main.py --config configs/train.yaml --mode basic
```

### í•™ìŠµ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
tail -f logs/$(date +%Y%m%d)/train/*.log

# GPU ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
watch -n 1 nvidia-smi
```

### ì²´í¬í¬ì¸íŠ¸ ê´€ë¦¬
```bash
# ìµœì‹  ëª¨ë¸ í™•ì¸
ls -la experiments/train/$(date +%Y%m%d)/*/results/ckpt/

# ì‹œê°í™” ì´ë¯¸ì§€ í™•ì¸  
ls -la experiments/train/$(date +%Y%m%d)/*/images/

# íŠ¹ì • fold ëª¨ë¸ ì‚¬ìš©
python src/training/train_main.py --config configs/train.yaml --resume --fold 0
```

## ğŸš€ ëª¨ë“  ì‹¤í–‰ ëª…ë ¹ì–´ ëª¨ìŒ

### ê¸°ë³¸ í•™ìŠµ ëª…ë ¹ì–´
```bash
# 1. ê¸°ë³¸ í•™ìŠµ (EfficientNet-B3, 224px)
python src/training/train_main.py --config configs/train.yaml

# 2. ê³ ì„±ëŠ¥ í•™ìŠµ (Swin-Base, 384px)
python src/training/train_main.py --config configs/train_highperf.yaml

# 3. ë¹ ë¥¸ í•™ìŠµ (í”„ë¡œí† íƒ€ì…ìš©)
python src/training/train_main.py --config configs/train_fast_optimized.yaml
```

### ê³ ê¸‰ í•™ìŠµ ì˜µì…˜
```bash
# 4. íŠ¹ì • ëª¨ë“œë¡œ í•™ìŠµ
python src/training/train_main.py --config configs/train.yaml --mode basic
python src/training/train_main.py --config configs/train.yaml --mode highperf
python src/training/train_main.py --config configs/train.yaml --mode fast

# 5. í•™ìŠµ ì¬ê°œ (ì²´í¬í¬ì¸íŠ¸ì—ì„œ)
python src/training/train_main.py --config configs/train.yaml --resume
python src/training/train_main.py --config configs/train.yaml --resume --fold 2

# 6. ìë™ ê³„ì† (ì¤‘ë‹¨ëœ í•™ìŠµ ìë™ ì¬ê°œ)
python src/training/train_main.py --config configs/train.yaml --auto-continue

# 7. íŠ¹ì • foldë§Œ í•™ìŠµ
python src/training/train_main.py --config configs/train.yaml --fold 0
python src/training/train_main.py --config configs/train.yaml --fold 1,2,3
```

### ìµœì í™” ê´€ë ¨ ëª…ë ¹ì–´
```bash
# 8. Optuna í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹
python src/training/train_main.py --config configs/train.yaml --optimize --n-trials 50

# 9. ë¹ ë¥¸ ìµœì í™” (ì ì€ trial)
python src/training/train_main.py --config configs/train_fast_optimized.yaml --optimize --n-trials 10

# 10. ë³´ì • í¬í•¨ í•™ìŠµ
python src/training/train_main.py --config configs/train.yaml --use-calibration

# 11. ìµœì í™” + ë³´ì • ì¡°í•©
python src/training/train_main.py --config configs/train_highperf.yaml --optimize --n-trials 30 --use-calibration
```

### GPU ë° ë°°ì¹˜ ì„¤ì •
```bash
# 12. íŠ¹ì • GPU ì§€ì •
CUDA_VISIBLE_DEVICES=0 python src/training/train_main.py --config configs/train.yaml
CUDA_VISIBLE_DEVICES=1 python src/training/train_main.py --config configs/train_highperf.yaml

# 13. ìë™ ë°°ì¹˜ í¬ê¸° ê²°ì •
python src/utils/gpu_optimization/auto_batch_size.py --config configs/train.yaml
python src/utils/gpu_optimization/auto_batch_size.py --config configs/train_highperf.yaml

# 14. GPU ìƒíƒœ í™•ì¸
python src/utils/gpu_optimization/team_gpu_check.py
```

### ë°ì´í„° ë° ì „ì²˜ë¦¬
```bash
# 15. ë°ì´í„° ì¤€ë¹„ í™•ì¸
ls -la data/raw/train/
head -5 data/raw/meta.csv

# 16. í´ë˜ìŠ¤ ë¶„í¬ í™•ì¸
python -c "
import pandas as pd
df = pd.read_csv('data/raw/meta.csv')
print('í´ë˜ìŠ¤ ë¶„í¬:')
print(df['label'].value_counts().sort_index())
print(f'\nì´ ì´ë¯¸ì§€ ìˆ˜: {len(df)}')
print(f'í´ë˜ìŠ¤ ìˆ˜: {df["label"].nunique()}')
"
```

### ëª¨ë‹ˆí„°ë§ ë° ë¡œê·¸
```bash
# 17. ì‹¤ì‹œê°„ í•™ìŠµ ë¡œê·¸ í™•ì¸
tail -f logs/$(date +%Y%m%d)/train/*.log

# 18. GPU ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§
watch -n 1 nvidia-smi

# 19. í•™ìŠµ ì§„í–‰ë¥  í™•ì¸
grep -i "epoch\|loss\|f1" logs/$(date +%Y%m%d)/train/*.log | tail -20

# 20. WandB ë™ê¸°í™”
wandb sync wandb/
```

### ê²°ê³¼ ë¶„ì„
```bash
# 21. ìµœì‹  ì‹¤í—˜ ê²°ê³¼ í™•ì¸ (ì „ì²´ êµ¬ì¡°)
ls -la experiments/train/$(date +%Y%m%d)/

# 22. ì²´í¬í¬ì¸íŠ¸ íŒŒì¼ í™•ì¸
find experiments/train -path "*/results/ckpt/*.pth" | head -10

# 22-1. ì‹œê°í™” ì´ë¯¸ì§€ í™•ì¸
find experiments/train/$(date +%Y%m%d) -name "*.png" | head -10

# 23. í•™ìŠµ ì„±ëŠ¥ ìš”ì•½
python -c "
import json, glob
metric_files = glob.glob('experiments/train/$(date +%Y%m%d)/*/results/metrics.json')
for file in metric_files:
    with open(file) as f:
        metrics = json.load(f)
        print(f'{file}: F1={metrics.get(\"best_f1\", \"N/A\"):.4f}')
"

# 24. ëª¨ë¸ í¬ê¸° í™•ì¸
ls -lh experiments/train/$(date +%Y%m%d)/*/results/ckpt/*.pth

# 25. ì‹œê°í™” ê²°ê³¼ í™•ì¸
echo "=== ìƒì„±ëœ ì‹œê°í™” ì°¨íŠ¸ ==="
find experiments/train/$(date +%Y%m%d) -name "*.png" -exec basename {} \; | sort
```

### ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
# 25. ë¹ ë¥¸ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
bash scripts/run_fast_training.sh

# 26. ê³ ì„±ëŠ¥ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸  
bash scripts/run_highperf_training.sh

# 27. í•™ìŠµ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸
bash scripts/monitor_training.sh
```

### í™˜ê²½ ì„¤ì •
```bash
# 28. Python í™˜ê²½ í™œì„±í™”
eval "$(pyenv init --path)" && pyenv activate cv_py3_11_9

# 29. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt

# 30. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
source path.env
```
