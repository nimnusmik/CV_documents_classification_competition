# ğŸ”® ì¶”ë¡  íŒŒì´í”„ë¼ì¸ ì™„ì „ ê°€ì´ë“œ (ê³ ê¸‰ ê¸°ë²• í†µí•©)

## ğŸ—ï¸ ì¶”ë¡  íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "CLI ì§„ì…ì "
        A[ğŸš€ infer_main.py<br/>í†µí•© ì¶”ë¡  ì¸í„°í˜ì´ìŠ¤<br/>CLI ì˜µì…˜ íŒŒì‹±]
    end
    
    subgraph "ì¶”ë¡  ëª¨ë“œ ì„ íƒ"
        B[ğŸ“š basic ëª¨ë“œ<br/>ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ <br/>infer.py ì‚¬ìš©]
        C[âš¡ highperf ëª¨ë“œ<br/>ì•™ìƒë¸” + TTA ì¶”ë¡ <br/>infer_highperf.py ì‚¬ìš©]
    end
    
    subgraph "ê³ ê¸‰ TTA ì‹œìŠ¤í…œ"
        D[ğŸ¯ Essential TTA<br/>5ê°€ì§€ í•µì‹¬ ë³€í™˜<br/>~17ë¶„ ì†Œìš”]
        E[ğŸŒŒ Comprehensive TTA<br/>15ê°€ì§€ í¬ê´„ë³€í™˜<br/>~50ë¶„+ ì†Œìš”]
        F[ğŸ”„ Legacy TTA<br/>íšŒì „ ê¸°ë°˜ ë³€í™˜<br/>~10ë¶„ ì†Œìš”]
    end
    
    subgraph "ì„±ëŠ¥ ë° ì‹œê°„"
        G[ğŸš€ ë¹ ë¥¸ ê²€ì¦<br/>basic ëª¨ë“œ<br/>5ë¶„, F1: 0.920-0.930]
        H[âš–ï¸ ê· í˜•ì <br/>Essential TTA<br/>17ë¶„, F1: 0.945-0.950]
        I[ğŸ† ìµœê³  ì„±ëŠ¥<br/>Comprehensive TTA<br/>50ë¶„+, F1: 0.965+]
    end
    
    subgraph "ê²°ê³¼ ì €ì¥"
        J[submissions/<br/>ì œì¶œ íŒŒì¼<br/>CSV í˜•ì‹]
        K[logs/infer/<br/>ì¶”ë¡  ë¡œê·¸<br/>ì„±ëŠ¥ ê¸°ë¡]
    end
    
    A --> B
    A --> C
    
    B --> F
    C --> D
    C --> E
    
    B --> G
    D --> H
    E --> I
    
    G --> J
    H --> J
    I --> J
    
    A --> K
    
    style A fill:#e1f5fe
    style C fill:#e8f5e8
    style D fill:#f3e5f5
    style E fill:#ffcdd2
    style I fill:#c8e6c9
```

---

## ğŸ“Š CLI ì˜µì…˜ ì™„ì „ ê°€ì´ë“œ

### ğŸ¯ ì¶”ë¡  ëª…ë ¹ì–´ ì˜µì…˜ í…Œì´ë¸”

| ì˜µì…˜ | íƒ€ì… | í•„ìˆ˜/ì„ íƒ | ê¸°ë³¸ê°’ | choices | ì„¤ëª… |
|------|------|----------|--------|---------|------|
| `--config` | str | í•„ìˆ˜ | - | - | ì„¤ì • YAML íŒŒì¼ ê²½ë¡œ |
| `--out` | str | ì„ íƒ | None | - | ì¶œë ¥ CSV íŒŒì¼ ê²½ë¡œ |
| `--ckpt` | str | ì„ íƒ | None | - | ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ íŒŒì¼ ê²½ë¡œ |
| `--mode` | str | ì„ íƒ | "highperf" | ["basic", "highperf"] | ì¶”ë¡  ëª¨ë“œ ì„ íƒ |
| `--fold-results` | str | ì„ íƒ | None | - | fold_results.yaml íŒŒì¼ ê²½ë¡œ (ê³ ì„±ëŠ¥ ëª¨ë“œ í•„ìˆ˜) |

---

## ğŸ¯ ê³ ê¸‰ TTA ì‹œìŠ¤í…œ ì™„ì „ ë¶„ì„

### ğŸ“Š TTA ì„±ëŠ¥ ë¹„êµí‘œ

| TTA íƒ€ì… | ë³€í™˜ ìˆ˜ | ì˜ˆìƒ ì‹œê°„ | ë©”ëª¨ë¦¬ ì‚¬ìš© | ì„±ëŠ¥ í–¥ìƒ | ì‚¬ìš© ê¶Œì¥ | êµ¬í˜„ ìœ„ì¹˜ |
|---------|--------|---------|----------|----------|---------|---------|
| **Essential** | 5ê°€ì§€ | ~17ë¶„ | ê¸°ë³¸ Ã— 5 | +2~3% | â­â­â­â­â­ | `transforms.py:221-250` |
| **Comprehensive** | 15ê°€ì§€ | ~50ë¶„+ | ê¸°ë³¸ Ã— 15 | +3~5% | â­â­â­â­ | `transforms.py:251-311` |
| Legacy (íšŒì „) | 3ê°€ì§€ | ~10ë¶„ | ê¸°ë³¸ Ã— 3 | +1~2% | â­â­â­ | `infer.py` ë ˆê±°ì‹œ |

### ğŸ”„ Essential TTA (5ê°€ì§€ í•µì‹¬ ë³€í™˜)

```python
# src/data/transforms.py:221-250ì— ì •ì˜ë¨
essential_tta_transforms = [
    "ì›ë³¸ ì´ë¯¸ì§€",                    # ê¸°ë³¸ ì „ì²˜ë¦¬ë§Œ
    "90ë„ íšŒì „",                     # ë¬¸ì„œ íšŒì „ ëŒ€ì‘
    "180ë„ íšŒì „",                    # ë’¤ì§‘íŒ ë¬¸ì„œ
    "270ë„ íšŒì „",                    # ì„¸ë¡œ ë¬¸ì„œ
    "ë°ê¸° ì¡°ì • (factor=1.2)"          # ì¡°ëª… ë³€í™” ëŒ€ì‘
]
```

### ğŸŒŸ Comprehensive TTA (15ê°€ì§€ í¬ê´„ ë³€í™˜)

```python
# src/data/transforms.py:251-311ì— ì •ì˜ë¨
comprehensive_tta_transforms = [
    # ê¸°ë³¸ ë³€í™˜ (5ê°€ì§€)
    "ì›ë³¸", "90ë„", "180ë„", "270ë„", "ë°ê¸° ì¡°ì •",
    
    # ê³ ê¸‰ ë³€í™˜ (10ê°€ì§€ ì¶”ê°€)
    "ìˆ˜í‰ ë’¤ì§‘ê¸°",                    # ì¢Œìš° ë°˜ì „ ë¬¸ì„œ
    "ìˆ˜ì§ ë’¤ì§‘ê¸°",                    # ìƒí•˜ ë°˜ì „ ë¬¸ì„œ  
    "ëŒ€ë¹„ ì¡°ì • (factor=1.3)",         # ìŠ¤ìº” í’ˆì§ˆ ë³€í™”
    "ì±„ë„ ì¡°ì • (factor=0.8)",         # ìƒ‰ìƒ ë³€í™” ëŒ€ì‘
    "ìƒ‰ì¡° ì¡°ì • (shift=0.1)",          # ìƒ‰ì˜¨ë„ ë³€í™”
    "ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ (sigma=0.5)",      # ì´ˆì  íë¦¼ ëŒ€ì‘
    "ìƒ¤í”„ë‹ (alpha=0.3)",            # ì„ ëª…ë„ ê°•í™”
    "ë…¸ì´ì¦ˆ ì¶”ê°€ (scale=10)",         # ìŠ¤ìº” ë…¸ì´ì¦ˆ ëŒ€ì‘
    "ì•½ê°„ íšŒì „ (-5ë„)",              # ë¯¸ì„¸ ê¸°ìš¸ì„ ëŒ€ì‘
    "ì•½ê°„ íšŒì „ (+5ë„)"               # ë¯¸ì„¸ ê¸°ìš¸ì„ ëŒ€ì‘
]
```

---

## ğŸš€ ì‹¤í–‰ ëª…ë ¹ì–´ ì™„ì „ ê°€ì´ë“œ

### 1. âš¡ ë¹ ë¥¸ ê²€ì¦ ì¶”ë¡  (5ë¶„)

```bash
# ê¸°ë³¸ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ 
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic

# íŠ¹ì • ì²´í¬í¬ì¸íŠ¸ ì§€ì •
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic \
    --ckpt experiments/train/lastest-train/best_fold0.pth
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 5ë¶„
- ğŸ“Š F1 Score: 0.920-0.930  
- ğŸ’¾ ë©”ëª¨ë¦¬: 8GB
- ğŸ¯ ìš©ë„: ë¹ ë¥¸ ê²€ì¦, í”„ë¡œí† íƒ€ì…

### 2. ğŸ¯ Essential TTA ì¶”ë¡  (17ë¶„, ê¶Œì¥)

```bash
# Essential TTA ì¶”ë¡  (5ê°€ì§€ í•µì‹¬ ë³€í™˜)
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# tta_typeì„ essentialë¡œ ì„¤ì • (configs/infer_highperf.yaml)
inference:
  tta_type: "essential"  # 5ê°€ì§€ í•µì‹¬ TTA
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 17ë¶„
- ğŸ“Š F1 Score: 0.945-0.950
- ğŸ’¾ ë©”ëª¨ë¦¬: 16GB
- ğŸ¯ ìš©ë„: **ê· í˜•ì  ê³ ì„±ëŠ¥ (ê¶Œì¥)**

### 3. ğŸ† Comprehensive TTA ì¶”ë¡  (50ë¶„+, ìµœê³ ì„±ëŠ¥)

```bash
# Comprehensive TTA ì¶”ë¡  (15ê°€ì§€ í¬ê´„ ë³€í™˜)
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# tta_typeì„ comprehensiveë¡œ ì„¤ì • (configs/infer_highperf.yaml)
inference:
  tta_type: "comprehensive"  # 15ê°€ì§€ í¬ê´„ TTA
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 50ë¶„+
- ğŸ“Š F1 Score: 0.965+
- ğŸ’¾ ë©”ëª¨ë¦¬: 24GB
- ğŸ¯ ìš©ë„: **ìµœì¢… ëŒ€íšŒ ì œì¶œìš©**

---

## ğŸ¨ TTA ì„¤ì • ë°©ë²•

### configs/infer_highperf.yaml ì„¤ì •

```yaml
# Team ê³ ì„±ëŠ¥ ì¶”ë¡  ì„¤ì •
model:
  name: "convnext_base_384_in22ft1k"  # Team ëª¨ë¸
  drop_rate: 0.05
  drop_path_rate: 0.1

inference:
  tta: true                           # TTA í™œì„±í™”
  tta_type: "essential"               # "essential" ë˜ëŠ” "comprehensive"
  confidence_threshold: 0.9           # ì•™ìƒë¸” ì‹ ë¢°ë„

# TTA íƒ€ì…ë³„ íŠ¹ì§•
# essential: 5ê°€ì§€, 17ë¶„, +2~3% ì„±ëŠ¥
# comprehensive: 15ê°€ì§€, 50ë¶„+, +3~5% ì„±ëŠ¥
```

---

## ğŸ“ˆ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

### ğŸ† ê³ ê¸‰ ê¸°ë²• vs ê¸°ì¡´ ì„±ëŠ¥ ë¹„êµ

| êµ¬ë¶„ | ëª¨ë¸ | TTA | F1 Score | ì„±ëŠ¥ í–¥ìƒ | ì‹œê°„ |
|------|------|-----|----------|----------|------|
| ê¸°ì¡´ ë² ì´ìŠ¤ë¼ì¸ | EfficientNet B3 | ì—†ìŒ | 0.9238 | - | 5ë¶„ |
| ê¸°ì¡´ + íšŒì „ TTA | EfficientNet B3 | Legacy | 0.9289 | +0.51% | 10ë¶„ |
| **Essential ê¸°ë²•** | ConvNeXt Base | Essential | **0.9489** | **+2.51%** | **17ë¶„** |
| **Comprehensive ê¸°ë²•** | ConvNeXt Base | Comprehensive | **0.9652** | **+4.14%** | **50ë¶„+** |

### ğŸ¯ ì¶”ë¡  ëª¨ë“œ ì„ íƒ ê°€ì´ë“œ

```mermaid
flowchart TD
    A[ì¶”ë¡  ëª©ì ] --> B{ëª©ì ì€?}
    
    B -->|ë¹ ë¥¸ ê²€ì¦| C[basic ëª¨ë“œ<br/>5ë¶„<br/>F1: 0.92-0.93]
    B -->|ê· í˜•ì  ì„±ëŠ¥| D[Essential TTA<br/>17ë¶„<br/>F1: 0.945-0.950]
    B -->|ìµœê³  ì„±ëŠ¥| E[Comprehensive TTA<br/>50ë¶„+<br/>F1: 0.965+]
    
    C --> F[ë‹¨ì¼ ì²´í¬í¬ì¸íŠ¸<br/>ë¹ ë¥¸ í”„ë¡œí† íƒ€ì…]
    D --> G[5-fold ì•™ìƒë¸”<br/>ì‹¤ìš©ì  ê³ ì„±ëŠ¥]
    E --> H[5-fold ì•™ìƒë¸”<br/>ëŒ€íšŒ ìš°ìŠ¹ ìˆ˜ì¤€]
    
    style D fill:#e8f5e8
    style G fill:#c8e6c9
```

---

## ğŸ› ï¸ ê³ ê¸‰ ì‚¬ìš©ë²•

### 1. ì»¤ìŠ¤í…€ ì¶œë ¥ ê²½ë¡œ ì§€ì •

```bash
# íŠ¹ì • ê²½ë¡œì— ê²°ê³¼ ì €ì¥
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml \
    --out submissions/custom/final_submission.csv
```

### 2. íŠ¹ì • ì²´í¬í¬ì¸íŠ¸ ì‚¬ìš©

```bash
# ì§ì ‘ ì²´í¬í¬ì¸íŠ¸ ì§€ì • (basic ëª¨ë“œì—ì„œë§Œ)
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic \
    --ckpt experiments/train/20250910/convnext/ckpt/best_fold2.pth \
    --out submissions/fold2_result.csv
```

### 3. GPU ë©”ëª¨ë¦¬ ìµœì í™”

```yaml
# configs/infer_highperf.yamlì—ì„œ ë°°ì¹˜ í¬ê¸° ì¡°ì •
train:
  batch_size: 32    # RTX 3080ìš© (ì›ë˜ 48)
  
# ë˜ëŠ” 16ìœ¼ë¡œ ë” ê°ì†Œ (RTX 3070ìš©)
train:
  batch_size: 16
```

---

## ğŸ“Š ê²°ê³¼ íŒŒì¼ ë¶„ì„

### ìƒì„±ë˜ëŠ” íŒŒì¼ë“¤

```bash
# ì‹¤í–‰ í›„ ìƒì„±ë˜ëŠ” íŒŒì¼ êµ¬ì¡°
submissions/20250910/
â”œâ”€â”€ 20250910_1430_convnext_base_384_essential_tta.csv      # Essential TTA ê²°ê³¼
â”œâ”€â”€ 20250910_1520_convnext_base_384_comprehensive_tta.csv  # Comprehensive TTA ê²°ê³¼
â””â”€â”€ 20250910_1200_efficientnet_b3_basic.csv               # Basic ëª¨ë“œ ê²°ê³¼

logs/20250910/infer/
â”œâ”€â”€ infer_highperf_20250910_1430.log                      # ê³ ì„±ëŠ¥ ì¶”ë¡  ë¡œê·¸
â””â”€â”€ infer_basic_20250910_1200.log                         # ê¸°ë³¸ ì¶”ë¡  ë¡œê·¸
```

### ê²°ê³¼ ê²€ì¦

```bash
# CSV íŒŒì¼ ê²€ì¦
python -c "
import pandas as pd
df = pd.read_csv('submissions/20250910/20250910_1430_convnext_base_384_essential_tta.csv')
print(f'Shape: {df.shape}')
print(f'Columns: {df.columns.tolist()}')
print(f'Missing values: {df.isnull().sum().sum()}')
print(f'Unique predictions: {df.iloc[:, 1].nunique()}')
"
```

---

## âš ï¸ ë¬¸ì œí•´ê²° ê°€ì´ë“œ

### ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜

#### 1. fold_results.yaml ì—†ìŒ
```bash
FileNotFoundError: fold_results.yaml not found
```
**í•´ê²°ë°©ë²•:**
```bash
# í•™ìŠµ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ fold_results.yaml ìƒì„±
python src/training/train_main.py --config configs/train_highperf.yaml --mode highperf

# ë˜ëŠ” ê¸°ì¡´ ê²°ê³¼ ì‚¬ìš©
--fold-results experiments/train/20250910/convnext_base_384_team/fold_results.yaml
```

#### 2. CUDA ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
RuntimeError: CUDA out of memory (TTA)
```
**í•´ê²°ë°©ë²•:**
```yaml
# configs/infer_highperf.yamlì—ì„œ ë°°ì¹˜ í¬ê¸° ê°ì†Œ
train:
  batch_size: 16  # 48 â†’ 16ìœ¼ë¡œ ê°ì†Œ

# ë˜ëŠ” Essential TTAë¡œ ì „í™˜
inference:
  tta_type: "essential"  # comprehensive â†’ essential
```

#### 3. í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì—†ìŒ
```bash
FileNotFoundError: test image not found
```
**í•´ê²°ë°©ë²•:**
```bash
# í…ŒìŠ¤íŠ¸ ë°ì´í„° ê²½ë¡œ í™•ì¸
ls data/raw/test/
head -5 data/raw/sample_submission.csv

# ì„¤ì •ì—ì„œ ê²½ë¡œ ìˆ˜ì •
data:
  image_dir_test: "./data/raw/test"
  sample_csv: "./data/raw/sample_submission.csv"
```

---

## ğŸ ìµœì¢… ì œì¶œ ì›Œí¬í”Œë¡œìš°

### Phase 1: ë¹ ë¥¸ ê²€ì¦ (5ë¶„)
```bash
# 1. ê¸°ë³¸ ëª¨ë¸ ê²€ì¦
python src/inference/infer_main.py --config configs/infer.yaml --mode basic
```

### Phase 2: ì‹¤ìš©ì  ê³ ì„±ëŠ¥ (17ë¶„, ê¶Œì¥)
```bash
# 2. Essential TTA ì¶”ë¡ 
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# configs/infer_highperf.yamlì—ì„œ:
# inference.tta_type: "essential"
```

### Phase 3: ìµœì¢… ìš°ìŠ¹ìš© (50ë¶„+)
```bash
# 3. Comprehensive TTA ì¶”ë¡ 
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# configs/infer_highperf.yamlì—ì„œ:
# inference.tta_type: "comprehensive"
```

### ğŸ¯ ì œì¶œ íŒŒì¼ ì„ íƒ
```bash
# ê°€ì¥ ì„±ëŠ¥ ì¢‹ì€ ê²°ê³¼ ì„ íƒ
BEST_FILE=$(ls -t submissions/$(date +%Y%m%d)/*comprehensive*.csv | head -1)
echo "ìµœì¢… ì œì¶œ íŒŒì¼: $BEST_FILE"

# ë°±ì—… ìƒì„±
cp "$BEST_FILE" "submissions/FINAL_SUBMISSION_$(date +%Y%m%d_%H%M).csv"
```