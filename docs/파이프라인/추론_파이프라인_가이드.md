# ğŸ”® ì¶”ë¡  íŒŒì´í”„ë¼ì¸ ì™„ì „ ê°€ì´ë“œ (ê³ ê¸‰ ê¸°ë²• í†µí•©)

## ğŸ—ï¸ ì¶”ë¡  íŒŒì´í”„ë¼ì¸ ì „ì²´ ì•„í‚¤í…ì²˜

```mermaid
flowchart TB
    subgraph CLI["ğŸš€ CLI ì§„ì…ì "]
        A["src/inference/infer_main.py<br/>í†µí•© ì¶”ë¡  ì¸í„°í˜ì´ìŠ¤<br/>CLI ì˜µì…˜ íŒŒì‹± ë° ëª¨ë“œ ì„ íƒ"]
    end
    
    subgraph MODES["ğŸ“‹ ì¶”ë¡  ëª¨ë“œ ë¶„ê¸°"]
        B["ğŸ“š basic ëª¨ë“œ<br/>src/inference/infer.py<br/>ë‹¨ì¼ ëª¨ë¸ ë¹ ë¥¸ ì¶”ë¡ "]
        C["âš¡ highperf ëª¨ë“œ<br/>src/inference/infer_highperf.py<br/>ì•™ìƒë¸” + TTA + ê³ ì„±ëŠ¥"]
    end
    
    subgraph INFERENCE["ğŸ¯ ì¶”ë¡  ì „ëµ"]
        D["ğŸ“ ë‹¨ì¼ ëª¨ë¸ ë‹¨ì¼ í´ë“œ<br/>1ê°œ ëª¨ë¸ + ê¸°ë³¸ ì¶”ë¡ <br/>5ë¶„, F1: 0.92-0.93"]
        E["ğŸ“ ë‹¨ì¼ ëª¨ë¸ K-fold<br/>5ê°œ ëª¨ë¸ ì•™ìƒë¸”<br/>15ë¶„, F1: 0.94-0.95"]
        F["ğŸ­ ë‹¤ì¤‘ ëª¨ë¸ ì•™ìƒë¸”<br/>ì—¬ëŸ¬ ì•„í‚¤í…ì²˜ ì¡°í•©<br/>30ë¶„+, F1: 0.96+"]
    end
    
    subgraph TTA["ğŸ¨ TTA ì „ëµ"]
        G["ğŸ¯ Essential TTA<br/>5ê°€ì§€ í•µì‹¬ ë³€í™˜<br/>íšŒì „ + ë°ê¸° ì¡°ì •"]
        H["ğŸŒŒ Comprehensive TTA<br/>15ê°€ì§€ í¬ê´„ ë³€í™˜<br/>ì „ì²´ ë³€í™˜ ì„¸íŠ¸"]
        I["ğŸ”„ No TTA<br/>ì›ë³¸ ì´ë¯¸ì§€ë§Œ<br/>ìµœëŒ€ ì†ë„"]
    end
    
    subgraph OPTIM["ğŸ” ìµœì í™” ê¸°ë²•"]
        J["ğŸŒ¡ï¸ Temperature Scaling<br/>src/calibration/calibrate.py<br/>í™•ë¥  ë³´ì •"]
        K["âš¡ Batch Size ìµœì í™”<br/>GPU ë©”ëª¨ë¦¬ íš¨ìœ¨í™”<br/>ìë™ ì¡°ì •"]
        L["ğŸ“Š Confidence Threshold<br/>ì•™ìƒë¸” ì‹ ë¢°ë„<br/>ì˜ˆì¸¡ í’ˆì§ˆ ê´€ë¦¬"]
    end
    
    A --> B & C
    B --> D & I
    C --> E & F
    E & F --> G & H
    G & H --> J & K & L
    
    style A fill:#e1f5fe, color:#000000
    style C fill:#e8f5e8, color:#000000
    style F fill:#f3e5f5, color:#000000
    style H fill:#ffcdd2, color:#000000
    style J fill:#fce4ec, color:#000000
```

## ğŸ”€ ì¶”ë¡  íŒŒì´í”„ë¼ì¸ ìƒì„¸ íë¦„ë„

### ğŸ“ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡  íë¦„
```mermaid
flowchart LR
    subgraph SINGLE["ğŸ¯ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ "]
        A1["âš™ï¸ ì„¤ì • ë¡œë“œ<br/>configs/infer.yaml<br/>ë‹¨ì¼ ëª¨ë¸ ì„¤ì •"]
        B1["ğŸ’¾ ì²´í¬í¬ì¸íŠ¸ ë¡œë“œ<br/>best_fold_N.pth<br/>íŠ¹ì • í´ë“œ ëª¨ë¸"]
        C1["ğŸ“¸ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€<br/>data/raw/test/<br/>ëŒ€ìƒ ì´ë¯¸ì§€ ë¡œë“œ"]
        D1["ğŸš€ ì¶”ë¡  ì‹¤í–‰<br/>ë¹ ë¥¸ ë‹¨ì¼ ì˜ˆì¸¡<br/>TTA ì—†ì´"]
        E1["ğŸ“„ ê²°ê³¼ ì €ì¥<br/>submissions/<br/>CSV í˜•ì‹"]
        
        A1 --> B1 --> C1 --> D1 --> E1
    end
    
    subgraph INFO1["ğŸ“‹ ë‹¨ì¼ ëª¨ë¸ ì •ë³´"]
        F1["âš¡ ì†ë„: 5ë¶„<br/>ğŸ¯ ì„±ëŠ¥: F1 0.92-0.93<br/>ğŸ’¾ ë©”ëª¨ë¦¬: 4-6GB"]
        G1["ğŸ”® ëª©ì : ë¹ ë¥¸ ê²€ì¦<br/>ğŸ¨ TTA: ì—†ìŒ<br/>ğŸ¯ ì‚¬ìš©: í”„ë¡œí† íƒ€ì…"]
    end
    
    style A1 fill:#e1f5fe, color:#000000
    style D1 fill:#e8f5e8, color:#000000
    style E1 fill:#fff3e0, color:#000000
```

### ğŸ­ ë‹¤ì¤‘ ëª¨ë¸ ì•™ìƒë¸” ì¶”ë¡  íë¦„
```mermaid
flowchart TB
    subgraph MULTI["ğŸ† ë‹¤ì¤‘ ëª¨ë¸ ì•™ìƒë¸” ì¶”ë¡ "]
        A2["âš™ï¸ ì•™ìƒë¸” ì„¤ì •<br/>configs/infer_multi_model_ensemble.yaml<br/>ë³µìˆ˜ ëª¨ë¸ ê²½ë¡œ"]
        
        B2["ğŸ—ï¸ ëª¨ë¸ 1: ConvNeXt<br/>best_fold_0-4.pth<br/>ê³ ì„±ëŠ¥ ë² ì´ìŠ¤ ëª¨ë¸"]
        C2["ğŸ—ï¸ ëª¨ë¸ 2: Swin<br/>swin_fold_0-4.pth<br/>Transformer ê¸°ë°˜"]
        D2["ğŸ—ï¸ ëª¨ë¸ 3: EfficientNet<br/>eff_fold_0-4.pth<br/>íš¨ìœ¨ì„± ì¤‘ì‹¬"]
        
        E2["ğŸ“¸ ë™ì¼ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€<br/>ëª¨ë¸ë³„ ì˜ˆì¸¡ ìˆ˜í–‰<br/>ë™ì‹œ ì‹¤í–‰"]
        F2["ğŸ¨ TTA ì „ëµ ì ìš©<br/>Essential/Comprehensive<br/>ëª¨ë¸ë³„ ë³€í™˜"]
        G2["âš–ï¸ ì•™ìƒë¸” ê°€ì¤‘ í‰ê· <br/>ëª¨ë¸ë³„ ì‹ ë¢°ë„ ë°˜ì˜<br/>ìµœì¢… ì˜ˆì¸¡ ìƒì„±"]
        H2["ğŸ“„ ìµœì¢… ê²°ê³¼ ì €ì¥<br/>ensemble_result.csv<br/>ìµœê³  ì„±ëŠ¥ ì¶œë ¥"]
        
        A2 --> B2 & C2 & D2
        B2 & C2 & D2 --> E2
        E2 --> F2 --> G2 --> H2
    end
    
    subgraph INFO2["ğŸ“‹ ë‹¤ì¤‘ ëª¨ë¸ ì •ë³´"]
        I2["ğŸ•°ï¸ ì†ë„: 30-60ë¶„<br/>ğŸ¯ ì„±ëŠ¥: F1 0.96-0.99<br/>ğŸ’¾ ë©”ëª¨ë¦¬: 24GB+"]
        J2["ğŸ¨ ë‹¤ì–‘ì„±: ì—¬ëŸ¬ ì•„í‚¤í…ì²˜<br/>ğŸ† ëª©ì : ìµœê³  ì„±ëŠ¥<br/>ğŸ† ì‚¬ìš©: ëŒ€íšŒ ìš°ìŠ¹ìš©"]
    end
    
    style A2 fill:#e1f5fe, color:#000000
    style F2 fill:#e8f5e8, color:#000000
    style G2 fill:#fff3e0, color:#000000
    style H2 fill:#f3e5f5, color:#000000
```

---

## ğŸ“Š CLI ì˜µì…˜ ì™„ì „ ê°€ì´ë“œ

### ğŸ¯ ì¶”ë¡  ëª…ë ¹ì–´ ì˜µì…˜ í…Œì´ë¸”

| ì˜µì…˜ | íƒ€ì… | í•„ìˆ˜/ì„ íƒ | ê¸°ë³¸ê°’ | choices | ì„¤ëª… |
|------|------|----------|--------|---------|------|
| `--config` | str | í•„ìˆ˜ | - | - | ì„¤ì • YAML íŒŒì¼ ê²½ë¡œ |
| `--out` | str | ì„ íƒ | None | - | ì¶œë ¥ CSV íŒŒì¼ ê²½ë¡œ |
| `--ckpt` | str | ì„ íƒ | None | - | ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ íŒŒì¼ ê²½ë¡œ |
| `--mode` | str | ì„ íƒ | "highperf" | ["basic", "highperf"] | ì¶”ë¡  ëª¨ë“œ ì„ íƒ |
| `--fold-results` | str | ì„ íƒ | None | - | fold_results.yaml íŒŒì¼ ê²½ë¡œ (ê³ ì„±ëŠ¥ ëª¨ë“œ í•„ìˆ˜) |

---

## ğŸ¯ ê³ ê¸‰ TTA ì‹œìŠ¤í…œ ì™„ì „ ë¶„ì„

### ğŸ“Š TTA ì„±ëŠ¥ ë¹„êµí‘œ

| TTA íƒ€ì… | ë³€í™˜ ìˆ˜ | ì˜ˆìƒ ì‹œê°„ | ë©”ëª¨ë¦¬ ì‚¬ìš© | ì„±ëŠ¥ í–¥ìƒ | ì‚¬ìš© ê¶Œì¥ | êµ¬í˜„ ìœ„ì¹˜ |
|---------|--------|---------|----------|----------|---------|---------|
| **Essential** | 5ê°€ì§€ | ~17ë¶„ | ê¸°ë³¸ Ã— 5 | +2~3% | â­â­â­â­â­ | `transforms.py:221-250` |
| **Comprehensive** | 15ê°€ì§€ | ~50ë¶„+ | ê¸°ë³¸ Ã— 15 | +3~5% | â­â­â­â­ | `transforms.py:251-311` |
| Legacy (íšŒì „) | 3ê°€ì§€ | ~10ë¶„ | ê¸°ë³¸ Ã— 3 | +1~2% | â­â­â­ | `infer.py` ë ˆê±°ì‹œ |

### ğŸ”„ Essential TTA (5ê°€ì§€ í•µì‹¬ ë³€í™˜)

```python
# src/data/transforms.py:221-250ì— ì •ì˜ë¨
essential_tta_transforms = [
    "ì›ë³¸ ì´ë¯¸ì§€",                    # ê¸°ë³¸ ì „ì²˜ë¦¬ë§Œ
    "90ë„ íšŒì „",                     # ë¬¸ì„œ íšŒì „ ëŒ€ì‘
    "180ë„ íšŒì „",                    # ë’¤ì§‘íŒ ë¬¸ì„œ
    "270ë„ íšŒì „",                    # ì„¸ë¡œ ë¬¸ì„œ
    "ë°ê¸° ì¡°ì • (factor=1.2)"          # ì¡°ëª… ë³€í™” ëŒ€ì‘
]
```

### ğŸŒŸ Comprehensive TTA (15ê°€ì§€ í¬ê´„ ë³€í™˜)

```python
# src/data/transforms.py:251-311ì— ì •ì˜ë¨
comprehensive_tta_transforms = [
    # ê¸°ë³¸ ë³€í™˜ (5ê°€ì§€)
    "ì›ë³¸", "90ë„", "180ë„", "270ë„", "ë°ê¸° ì¡°ì •",
    
    # ê³ ê¸‰ ë³€í™˜ (10ê°€ì§€ ì¶”ê°€)
    "ìˆ˜í‰ ë’¤ì§‘ê¸°",                    # ì¢Œìš° ë°˜ì „ ë¬¸ì„œ
    "ìˆ˜ì§ ë’¤ì§‘ê¸°",                    # ìƒí•˜ ë°˜ì „ ë¬¸ì„œ  
    "ëŒ€ë¹„ ì¡°ì • (factor=1.3)",         # ìŠ¤ìº” í’ˆì§ˆ ë³€í™”
    "ì±„ë„ ì¡°ì • (factor=0.8)",         # ìƒ‰ìƒ ë³€í™” ëŒ€ì‘
    "ìƒ‰ì¡° ì¡°ì • (shift=0.1)",          # ìƒ‰ì˜¨ë„ ë³€í™”
    "ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ (sigma=0.5)",      # ì´ˆì  íë¦¼ ëŒ€ì‘
    "ìƒ¤í”„ë‹ (alpha=0.3)",            # ì„ ëª…ë„ ê°•í™”
    "ë…¸ì´ì¦ˆ ì¶”ê°€ (scale=10)",         # ìŠ¤ìº” ë…¸ì´ì¦ˆ ëŒ€ì‘
    "ì•½ê°„ íšŒì „ (-5ë„)",              # ë¯¸ì„¸ ê¸°ìš¸ì„ ëŒ€ì‘
    "ì•½ê°„ íšŒì „ (+5ë„)"               # ë¯¸ì„¸ ê¸°ìš¸ì„ ëŒ€ì‘
]
```

---

## ğŸš€ ì‹¤í–‰ ëª…ë ¹ì–´ ì™„ì „ ê°€ì´ë“œ

### 1. ğŸ“ ë‹¨ì¼ ëª¨ë¸ ë‹¨ì¼ í´ë“œ ì¶”ë¡  (5ë¶„)

```bash
# ê¸°ë³¸ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡  (TTA ì—†ìŒ)
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic

# íŠ¹ì • í´ë“œ ì²´í¬í¬ì¸íŠ¸ ì§€ì •
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic \
    --ckpt experiments/train/latest-train/best_fold2.pth

# ì»¤ìŠ¤í…€ ì¶œë ¥ ê²½ë¡œ
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic \
    --out submissions/quick_test.csv
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 5ë¶„
- ğŸ“Š F1 Score: 0.920-0.930  
- ğŸ’¾ ë©”ëª¨ë¦¬: 4-6GB
- ğŸ¯ ìš©ë„: ë¹ ë¥¸ ê²€ì¦, í”„ë¡œí† íƒ€ì…, ë‹¨ì¼ ëª¨ë¸ í…ŒìŠ¤íŠ¸

### 2. ğŸ¯ Essential TTA ì¶”ë¡  (17ë¶„, ê¶Œì¥)

```bash
# Essential TTA ì¶”ë¡  (5ê°€ì§€ í•µì‹¬ ë³€í™˜)
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# tta_typeì„ essentialë¡œ ì„¤ì • (configs/infer_highperf.yaml)
inference:
  tta_type: "essential"  # 5ê°€ì§€ í•µì‹¬ TTA
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 17ë¶„
- ğŸ“Š F1 Score: 0.945-0.950
- ğŸ’¾ ë©”ëª¨ë¦¬: 16GB
- ğŸ¯ ìš©ë„: **ê· í˜•ì  ê³ ì„±ëŠ¥ (ê¶Œì¥)**

### 3. ğŸ† Comprehensive TTA ì¶”ë¡  (50ë¶„+, ìµœê³ ì„±ëŠ¥)

```bash
# Comprehensive TTA ì¶”ë¡  (15ê°€ì§€ í¬ê´„ ë³€í™˜)
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# tta_typeì„ comprehensiveë¡œ ì„¤ì • (configs/infer_highperf.yaml)
inference:
  tta_type: "comprehensive"  # 15ê°€ì§€ í¬ê´„ TTA
```

**ì˜ˆìƒ ê²°ê³¼:**
- â° ì‹œê°„: 50ë¶„+
- ğŸ“Š F1 Score: 0.965+
- ğŸ’¾ ë©”ëª¨ë¦¬: 24GB
- ğŸ¯ ìš©ë„: **ìµœì¢… ëŒ€íšŒ ì œì¶œìš©**

---

## ğŸ¨ TTA ì„¤ì • ë°©ë²•

### configs/infer_highperf.yaml ì„¤ì •

```yaml
# Team ê³ ì„±ëŠ¥ ì¶”ë¡  ì„¤ì •
model:
  name: "convnext_base_384_in22ft1k"  # Team ëª¨ë¸
  drop_rate: 0.05
  drop_path_rate: 0.1

inference:
  tta: true                           # TTA í™œì„±í™”
  tta_type: "essential"               # "essential" ë˜ëŠ” "comprehensive"
  confidence_threshold: 0.9           # ì•™ìƒë¸” ì‹ ë¢°ë„

# TTA íƒ€ì…ë³„ íŠ¹ì§•
# essential: 5ê°€ì§€, 17ë¶„, +2~3% ì„±ëŠ¥
# comprehensive: 15ê°€ì§€, 50ë¶„+, +3~5% ì„±ëŠ¥
```

## ğŸ“ íŒŒì¼ ê°„ ì˜ì¡´ ê´€ê³„ ë° ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

### ğŸ¯ ì¶”ë¡  ì‹œìŠ¤í…œ ì „ì²´ ì˜ì¡´ ê´€ê³„
```mermaid
graph TB
    subgraph CONFIGS["âš™ï¸ ì¶”ë¡  ì„¤ì • íŒŒì¼"]
        CONFIG1["configs/infer.yaml<br/>ğŸ“ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ <br/>ë¹ ë¥¸ ê²€ì¦ìš©"]
        CONFIG2["configs/infer_highperf.yaml<br/>âš¡ K-fold ì•™ìƒë¸” + TTA<br/>ìµœê³  ì„±ëŠ¥ìš©"]
        CONFIG3["configs/infer_multi_model_ensemble.yaml<br/>ğŸ­ ë‹¤ì¤‘ ëª¨ë¸ ì•™ìƒë¸”<br/>ì—¬ëŸ¬ ì•„í‚¤í…ì²˜"]
        CONFIG4["configs/infer_calibrated.yaml<br/>ğŸŒ¡ï¸ Temperature Scaling<br/>Optuna ìµœì í™” ì—°ë™"]
    end
    
    subgraph CORE["ğŸ§  í•µì‹¬ ì¶”ë¡  ì‹œìŠ¤í…œ"]
        MAIN["src/inference/infer_main.py<br/>ğŸš€ ë©”ì¸ CLI ì¸í„°í˜ì´ìŠ¤<br/>ëª¨ë“œ ì„ íƒ ë° ì˜µì…˜"]
        INFER_BASIC["src/inference/infer.py<br/>ğŸ“š ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ <br/>ê¸°ë³¸ TTA ë˜ëŠ” TTA ì—†ìŒ"]
        INFER_HIGH["src/inference/infer_highperf.py<br/>âš¡ ê³ ì„±ëŠ¥ ì•™ìƒë¸” ì¶”ë¡ <br/>K-fold + Essential/Comprehensive TTA"]
        INFER_CALIB["src/inference/infer_calibrated.py<br/>ğŸŒ¡ï¸ ë³´ì •ëœ ì¶”ë¡ <br/>Temperature Scaling ì ìš©"]
    end
    
    subgraph SUPPORT["ğŸ”§ ì§€ì› ì‹œìŠ¤í…œ"]
        MODELS["src/models/build.py<br/>ğŸ—ï¸ ëª¨ë¸ ë¹Œë”<br/>ì²´í¬í¬ì¸íŠ¸ ë¡œë“œ"]
        DATA["src/data/dataset.py<br/>ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë”<br/>ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸"]
        TRANSFORMS["src/data/transforms.py<br/>ğŸ¨ TTA ë³€í™˜<br/>Essential/Comprehensive TTA"]
        CALIBRATION["src/calibration/calibrate.py<br/>ğŸŒ¡ï¸ Temperature Scaling<br/>ëª¨ë¸ ë³´ì •"]
        OPTIMIZATION["src/optimization/<br/>ğŸ” ìµœì í™” ì—°ë™<br/>ì¶”ë¡  íŒŒë¼ë¯¸í„° íŠœë‹"]
    end
    
    subgraph INPUT["ğŸ“¥ ì…ë ¥ ë°ì´í„°"]
        TEST_IMGS["data/raw/test/<br/>ğŸ“¸ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€<br/>ì˜ˆì¸¡ ëŒ€ìƒ"]
        SAMPLE_CSV["data/raw/sample_submission.csv<br/>ğŸ“„ ì œì¶œ í˜•ì‹<br/>ê²°ê³¼ í…œí”Œë¦¿"]
        FOLD_RESULTS["experiments/train/*/fold_results.yaml<br/>ğŸ“Š í´ë“œ ë©”íƒ€ë°ì´í„°<br/>ëª¨ë¸ ê²½ë¡œ + ì„±ëŠ¥"]
        CHECKPOINTS["experiments/train/*/ckpt/*.pth<br/>ğŸ’¾ í•™ìŠµëœ ëª¨ë¸<br/>ê°€ì¤‘ì¹˜ íŒŒì¼"]
    end
    
    subgraph OUTPUT["ğŸ“¤ ì¶œë ¥ ê²°ê³¼"]
        SINGLE_OUT["submissions/YYYYMMDD/<br/>ğŸ“ ë‹¨ì¼ ëª¨ë¸ ê²°ê³¼<br/>single_model_*.csv"]
        ENSEMBLE_OUT["submissions/YYYYMMDD/<br/>ğŸ­ K-fold ì•™ìƒë¸” ê²°ê³¼<br/>ensemble_*.csv"]
        MULTI_OUT["submissions/YYYYMMDD/<br/>ğŸ† ë‹¤ì¤‘ ëª¨ë¸ ê²°ê³¼<br/>multi_model_*.csv"]
        CALIB_OUT["submissions/YYYYMMDD/<br/>ğŸŒ¡ï¸ ë³´ì • ê²°ê³¼<br/>calibrated_*.csv"]
        LOGS["logs/YYYYMMDD/infer/<br/>ğŸ“ ì¶”ë¡  ë¡œê·¸<br/>ì„±ëŠ¥ ê¸°ë¡"]
    end
    
    %% ì„¤ì • íŒŒì¼ â†’ ë©”ì¸ ì‹œìŠ¤í…œ ì—°ê²°
    CONFIG1 --> MAIN
    CONFIG2 --> MAIN
    CONFIG3 --> MAIN
    CONFIG4 --> MAIN
    
    %% ë©”ì¸ ì‹œìŠ¤í…œ â†’ ì¶”ë¡  ë¡œì§ ë¶„ê¸°
    MAIN --> INFER_BASIC
    MAIN --> INFER_HIGH
    MAIN --> INFER_CALIB
    
    %% ì¶”ë¡  ë¡œì§ â†’ ì§€ì› ì‹œìŠ¤í…œ ì˜ì¡´
    INFER_BASIC --> MODELS & DATA
    INFER_HIGH --> MODELS & DATA & TRANSFORMS
    INFER_CALIB --> MODELS & DATA & CALIBRATION & OPTIMIZATION
    
    %% ì…ë ¥ ë°ì´í„° â†’ ì¶”ë¡  ì‹œìŠ¤í…œ
    TEST_IMGS --> DATA
    SAMPLE_CSV --> INFER_BASIC & INFER_HIGH & INFER_CALIB
    FOLD_RESULTS --> INFER_HIGH & INFER_CALIB
    CHECKPOINTS --> MODELS
    
    %% ì¶”ë¡  â†’ ì¶œë ¥ ìƒì„±
    INFER_BASIC --> SINGLE_OUT & LOGS
    INFER_HIGH --> ENSEMBLE_OUT & MULTI_OUT & LOGS
    INFER_CALIB --> CALIB_OUT & LOGS
    
    style CONFIG2 fill:#e8f5e8, color:#000000
    style CONFIG3 fill:#f3e5f5, color:#000000
    style MAIN fill:#fff3e0, color:#000000
    style INFER_HIGH fill:#ffcdd2, color:#000000
    style ENSEMBLE_OUT fill:#e1f5fe, color:#000000
    style MULTI_OUT fill:#fce4ec, color:#000000
```

---

## ğŸ“ˆ ì¶”ë¡  ëª¨ë“œë³„ ì„±ëŠ¥ ë° íŠ¹ì§• ë¶„ì„

### ğŸ¯ ì¶”ë¡  ì „ëµë³„ ë¹„êµ ë¶„ì„

| ì¶”ë¡  ì „ëµ | ì†ë„ | ì˜ˆìƒ F1 | GPU ë©”ëª¨ë¦¬ | TTA ì „ëµ | ìµœì  í™œìš© ìƒí™© |
|------------|------|---------|-----------|----------|---------------|
| **ğŸ“ ë‹¨ì¼ ëª¨ë¸ ì¶”ë¡ ** | âš¡ 5ë¶„ | 0.92-0.93 | 4-6GB | No TTA | ì´ˆê¸° ê²€ì¦, ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ |
| **ğŸ¯ ë‹¨ì¼ ëª¨ë¸ + TTA** | ğŸ•°ï¸ 17ëµ¤ | 0.94-0.95 | 8GB | Essential | ê· í˜•ì  ì„±ëŠ¥ |
| **ğŸ”€ K-fold ì•™ìƒë¸”** | ğŸ”„ 30ë¶„ | 0.95-0.97 | 16GB | Essential/Comp | ì•ˆì •ì  ê³ ì„±ëŠ¥ |
| **ğŸ­ ë‹¤ì¤‘ ëª¨ë¸** | ğŸ† 60ë¶„ | 0.96-0.99 | 24GB+ | Comprehensive | ëŒ€íšŒ ìš°ìŠ¹ìš© |

### ğŸ† TTA ë³€í™˜ë³„ ì„±ëŠ¥ ê¸°ì—¬ë„

| TTA ë°©ì‹ | ë³€í™˜ ìˆ˜ | ì‹œê°„ ë¹„ìš© | ì„±ëŠ¥ ê¸°ì—¬ | ì¶”ì²œ ìƒí™© | êµ¬í˜„ ìœ„ì¹˜ |
|------------|--------|---------|----------|----------|----------|
| **No TTA** | 1ê°œ | âš¡ ê¸°ì¤€ | ê¸°ì¤€ | ì´ˆê¸° ê²€ì¦ | `infer.py` |
| **Essential TTA** | 5ê°œ | 5ë°° | **+2.0%** | **ê· í˜•ì  ì¶”ì²œ** | `transforms.py:221-250` |
| **Comprehensive TTA** | 15ê°œ | 15ë°° | **+4.0%** | ìµœê³  ì„±ëŠ¥ | `transforms.py:251-311` |
| **Legacy TTA** | 3ê°œ | 3ë°° | +1.0% | ë ˆê±°ì‹œ | ê¸°ì¡´ ì½”ë“œ |

### ğŸ” Optuna ìµœì í™” ì—°ë™ ì¶”ë¡  ì „ëµ

#### ì¶”ë¡  ì‹œ Optuna í™œìš© ë°©ì‹
- **Temperature Scaling ìµœì í™”**: ì˜ˆì¸¡ í™•ë¥  ë³´ì •
- **TTA ê°€ì¤‘ì¹˜ ìµœì í™”**: ë³€í™˜ë³„ ê°€ì¤‘ì¹˜ ìë™ íŠœë‹
- **Ensemble ê°€ì¤‘ì¹˜ ìµœì í™”**: ëª¨ë¸ë³„ ê¸°ì—¬ë„ ìë™ ì¡°ì •
- **Confidence Threshold ìµœì í™”**: ì˜ˆì¸¡ ì‹ ë¢°ë„ ì„ê³„ê°’ íŠœë‹

#### Optuna ìµœì í™” ì„±ëŠ¥ í–¥ìƒ
| ê¸°ë³¸ ì¶”ë¡  | Optuna ìµœì í™” | ì„±ëŠ¥ í–¥ìƒ |
|-----------|-----------------|----------|
| F1: 0.950 | F1: 0.965+ | **+1.5%** |
| ë§¤ë“œ ì„¤ì • | ìë™ íŠœë‹ | **ì•ˆì •ì„±** |

### ğŸ† ê³ ê¸‰ ê¸°ë²• vs ê¸°ì¡´ ì„±ëŠ¥ ë¹„êµ

| êµ¬ë¶„ | ëª¨ë¸ | TTA | ì•™ìƒë¸” | F1 Score | ì„±ëŠ¥ í–¥ìƒ | ì‹œê°„ |
|------|------|-----|-------|----------|----------|------|
| ê¸°ì¡´ ë² ì´ìŠ¤ë¼ì¸ | EfficientNet B3 | ì—†ìŒ | ë‹¨ì¼ | 0.9238 | - | 5ë¶„ |
| ê¸°ì¡´ + íšŒì „ TTA | EfficientNet B3 | Legacy | ë‹¨ì¼ | 0.9289 | +0.51% | 10ë¶„ |
| **Essential ê¸°ë²•** | ConvNeXt Base | Essential | 5-fold | **0.9489** | **+2.51%** | **17ë¶„** |
| **Comprehensive ê¸°ë²•** | ConvNeXt Base | Comprehensive | 5-fold | **0.9652** | **+4.14%** | **50ë¶„+** |
| **ë‹¤ì¤‘ ëª¨ë¸ ìµœê³ ** | Multi-Model | Comprehensive | Multi | **0.9750+** | **+5.12%** | **90ë¶„+** |

### ğŸ¯ ì¶”ë¡  ëª¨ë“œ ì„ íƒ ê°€ì´ë“œ

```mermaid
flowchart TD
    A[ì¶”ë¡  ëª©ì ] --> B{ìƒí™©ì— ë”°ë¥¸ ì„ íƒ}
    
    B -->|ë¹ ë¥¸ ê²€ì¦ í•„ìš”| C[ğŸ“ ë‹¨ì¼ ëª¨ë¸<br/>5ë¶„<br/>F1: 0.92-0.93]
    B -->|ê· í˜•ì  ì„±ëŠ¥| D[ğŸ¯ Essential TTA<br/>17ë¶„<br/>F1: 0.945-0.950]
    B -->|ê³ ì„±ëŠ¥ ì•™ìƒë¸”| E[ğŸ”€ K-fold ì•™ìƒë¸”<br/>30ë¶„<br/>F1: 0.95-0.97]
    B -->|ìµœê³  ì„±ëŠ¥| F[ğŸ† ë‹¤ì¤‘ ëª¨ë¸<br/>60ë¶„+<br/>F1: 0.96-0.99]
    
    C --> G[ë‹¨ì¼ ì²´í¬í¬ì¸íŠ¸<br/>--mode basic<br/>ë¹ ë¥¸ í”„ë¡œí† íƒ€ì…]
    D --> H[TTA ì „ëµ ì ìš©<br/>--mode highperf<br/>ì‹¤ìš©ì  ê³ ì„±ëŠ¥]
    E --> I[5-fold ì•™ìƒë¸”<br/>fold_results.yaml<br/>ì•ˆì •ì  ì„±ëŠ¥]
    F --> J[ë‹¤ì¤‘ ëª¨ë¸ ì¡°í•©<br/>multi_model_ensemble<br/>ëŒ€íšŒ ìš°ìŠ¹ ìˆ˜ì¤€]
    
    %% ì¶”ê°€ ê¸°ë²• ë¶„ê¸°
    H --> K{TTA ìœ í˜•}
    K -->|ê· í˜•| L[Essential TTA<br/>5ê°€ì§€ ë³€í™˜]
    K -->|ìµœê³ | M[Comprehensive TTA<br/>15ê°€ì§€ ë³€í™˜]
    
    I --> N{ì˜µì…˜ ê¸°ë²•}
    N -->|ê¸°ë³¸| O[ê¸°ë³¸ ì•™ìƒë¸”]
    N -->|ë³´ì •| P[Temperature Scaling<br/>--use-calibration]
    N -->|ìµœì í™”| Q[Optuna íŠœë‹<br/>threshold ìµœì í™”]
    
    style D fill:#e8f5e8, color:#000000
    style E fill:#f3e5f5, color:#000000
    style H fill:#c8e6c9, color:#000000
    style I fill:#ffcdd2, color:#000000
    style P fill:#fce4ec, color:#000000
```

---

## ğŸ› ï¸ ê³ ê¸‰ ì‚¬ìš©ë²•

### 1. ì»¤ìŠ¤í…€ ì¶œë ¥ ê²½ë¡œ ì§€ì •

```bash
# íŠ¹ì • ê²½ë¡œì— ê²°ê³¼ ì €ì¥
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml \
    --out submissions/custom/final_submission.csv
```

### 2. íŠ¹ì • ì²´í¬í¬ì¸íŠ¸ ì‚¬ìš©

```bash
# ì§ì ‘ ì²´í¬í¬ì¸íŠ¸ ì§€ì • (basic ëª¨ë“œì—ì„œë§Œ)
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --mode basic \
    --ckpt experiments/train/20250910/convnext/ckpt/best_fold2.pth \
    --out submissions/fold2_result.csv
```

### 3. GPU ë©”ëª¨ë¦¬ ìµœì í™”

```yaml
# configs/infer_highperf.yamlì—ì„œ ë°°ì¹˜ í¬ê¸° ì¡°ì •
train:
  batch_size: 32    # RTX 3080ìš© (ì›ë˜ 48)
  
# ë˜ëŠ” 16ìœ¼ë¡œ ë” ê°ì†Œ (RTX 3070ìš©)
train:
  batch_size: 16
```

---

## ğŸ“Š ê²°ê³¼ íŒŒì¼ ë¶„ì„

### ìƒì„±ë˜ëŠ” íŒŒì¼ë“¤

```bash
# ì‹¤í–‰ í›„ ìƒì„±ë˜ëŠ” íŒŒì¼ êµ¬ì¡°
submissions/20250910/
â”œâ”€â”€ 20250910_1430_convnext_base_384_essential_tta.csv      # Essential TTA ê²°ê³¼
â”œâ”€â”€ 20250910_1520_convnext_base_384_comprehensive_tta.csv  # Comprehensive TTA ê²°ê³¼
â””â”€â”€ 20250910_1200_efficientnet_b3_basic.csv               # Basic ëª¨ë“œ ê²°ê³¼

logs/20250910/infer/
â”œâ”€â”€ infer_highperf_20250910_1430.log                      # ê³ ì„±ëŠ¥ ì¶”ë¡  ë¡œê·¸
â””â”€â”€ infer_basic_20250910_1200.log                         # ê¸°ë³¸ ì¶”ë¡  ë¡œê·¸
```

### ê²°ê³¼ ê²€ì¦

```bash
# CSV íŒŒì¼ ê²€ì¦
python -c "
import pandas as pd
df = pd.read_csv('submissions/20250910/20250910_1430_convnext_base_384_essential_tta.csv')
print(f'Shape: {df.shape}')
print(f'Columns: {df.columns.tolist()}')
print(f'Missing values: {df.isnull().sum().sum()}')
print(f'Unique predictions: {df.iloc[:, 1].nunique()}')
"
```

---

## âš ï¸ ë¬¸ì œí•´ê²° ê°€ì´ë“œ

### ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜

#### 1. fold_results.yaml ì—†ìŒ
```bash
FileNotFoundError: fold_results.yaml not found
```
**í•´ê²°ë°©ë²•:**
```bash
# í•™ìŠµ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ fold_results.yaml ìƒì„±
python src/training/train_main.py --config configs/train_highperf.yaml --mode highperf

# ë˜ëŠ” ê¸°ì¡´ ê²°ê³¼ ì‚¬ìš©
--fold-results experiments/train/20250910/convnext_base_384_team/fold_results.yaml
```

#### 2. CUDA ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
RuntimeError: CUDA out of memory (TTA)
```
**í•´ê²°ë°©ë²•:**
```yaml
# configs/infer_highperf.yamlì—ì„œ ë°°ì¹˜ í¬ê¸° ê°ì†Œ
train:
  batch_size: 16  # 48 â†’ 16ìœ¼ë¡œ ê°ì†Œ

# ë˜ëŠ” Essential TTAë¡œ ì „í™˜
inference:
  tta_type: "essential"  # comprehensive â†’ essential
```

#### 3. í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì—†ìŒ
```bash
FileNotFoundError: test image not found
```
**í•´ê²°ë°©ë²•:**
```bash
# í…ŒìŠ¤íŠ¸ ë°ì´í„° ê²½ë¡œ í™•ì¸
ls data/raw/test/
head -5 data/raw/sample_submission.csv

# ì„¤ì •ì—ì„œ ê²½ë¡œ ìˆ˜ì •
data:
  image_dir_test: "./data/raw/test"
  sample_csv: "./data/raw/sample_submission.csv"
```

---

## ğŸ ìµœì¢… ì œì¶œ ì›Œí¬í”Œë¡œìš°

### Phase 1: ë¹ ë¥¸ ê²€ì¦ (5ë¶„)
```bash
# 1. ê¸°ë³¸ ëª¨ë¸ ê²€ì¦
python src/inference/infer_main.py --config configs/infer.yaml --mode basic
```

### Phase 2: ì‹¤ìš©ì  ê³ ì„±ëŠ¥ (17ë¶„, ê¶Œì¥)
```bash
# 2. Essential TTA ì¶”ë¡ 
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# configs/infer_highperf.yamlì—ì„œ:
# inference.tta_type: "essential"
```

### Phase 3: ìµœì¢… ìš°ìŠ¹ìš© (50ë¶„+)
```bash
# 3. Comprehensive TTA ì¶”ë¡ 
python src/inference/infer_main.py \
    --config configs/infer_highperf.yaml \
    --mode highperf \
    --fold-results experiments/train/lastest-train/fold_results.yaml

# configs/infer_highperf.yamlì—ì„œ:
# inference.tta_type: "comprehensive"
```

### ğŸ¯ ì œì¶œ íŒŒì¼ ì„ íƒ
```bash
# ê°€ì¥ ì„±ëŠ¥ ì¢‹ì€ ê²°ê³¼ ì„ íƒ
BEST_FILE=$(ls -t submissions/$(date +%Y%m%d)/*comprehensive*.csv | head -1)
echo "ìµœì¢… ì œì¶œ íŒŒì¼: $BEST_FILE"

# ë°±ì—… ìƒì„±
cp "$BEST_FILE" "submissions/FINAL_SUBMISSION_$(date +%Y%m%d_%H%M).csv"
```